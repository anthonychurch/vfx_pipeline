import maya.cmds
import random
import math


#### START - Common Methods ###############################################################################################################################################################################

#### START - UI Methods     ###############################################################################################################################################################################
def deleteWindow( windowName ):
	exist = maya.cmds.window( windowName, exists=True )
	if(exist == 1):
		maya.cmds.deleteUI(windowName, window=True)
#### END   - UI Methods     ###############################################################################################################################################################################

def getWStransform(obj):
	transform = maya.cmds.xform( obj, q=True, ws=True, t=True )
	return transform

def testNodeType(node,type):
	value = True
	nodeType = maya.cmds.objectType( node )
	if( nodeType != type ):
		value = False
		#print 'WARNING:: testNodeType : ' + str(nodeType) + ' does not match ' + type + '/n'
	return value

def getWSrotate(obj):
	rotate = maya.cmds.xform( obj, q=True, ws=True, ro=True )
	return rotate

def setWStransform(obj,position):
	maya.cmds.xform( obj, ws=True, t=(position[0],position[1],position[2]) )

def setWSrotate(obj,rotate):
	maya.cmds.xform( obj, ws=True, ro=(rotate[0],rotate[1],rotate[2]) )

def findName(name,token):
	newName = name[len(token):len(name)]	
	return newName

def setupPolVector(pvCtrl,joint,distance,upAxis):
	pvGrp = pvCtrl + '_GRP'
	pos = getWStransform(joint)
	setWStransform(pvGrp,pos)
	rot = getWSrotate(joint)
	setWSrotate(pvGrp,rot)
	maya.cmds.parent(pvGrp,joint)
	maya.cmds.setAttr(pvGrp + '.t' + upAxis, distance)
	maya.cmds.parent(pvGrp,world=True)

def incrementPos(increment,value,axis):
	vector = (0,0,0)
	value = value + increment
	if(axis == 'x'):
		vector = (value,0,0)
	elif(axis == 'y'):
		vector = (0,value,0)
	else:
		vector = (0,0,value)
	return vector

def setJointOriention(obj):
	rx = maya.cmds.getAttr(str(obj) + '.rotateX')
	print('rx = ' + str(rx))
	maya.cmds.setAttr(str(obj) + '.jointOrientX', rx)
	ry = maya.cmds.getAttr(str(obj) + '.rotateY')
	print('ry = ' + str(ry))
	maya.cmds.setAttr(str(obj) + '.jointOrientY', ry)
	rz = maya.cmds.getAttr(str(obj) + '.rotateZ')
	print('rz = ' + str(rz))
	maya.cmds.setAttr(str(obj) + '.jointOrientZ', rz)
	maya.cmds.setAttr(str(obj) + '.rotateX', 0)
	maya.cmds.setAttr(str(obj) + '.rotateY', 0)
	maya.cmds.setAttr(str(obj) + '.rotateZ', 0)

def findNamePrefix(name,token):
	newName = name[len(token):len(name)]	
	return newName

def getDistance2Vectors(pointA,pointB):
	sp = getWStransform(pointA)
	ep = getWStransform(pointB)
	distance = math.sqrt(  math.pow(sp[0]-ep[0],2) + math.pow(sp[1]-ep[1],2) + math.pow(sp[2]-ep[2],2)  )
	return distance

def renamePrefixSuffix(array,prefix,suffix):
	returnArray = []
	for item in array:
		temp = maya.cmds.rename(item,prefix + item + suffix)
		returnArray.append(temp)

	return returnArray

def setUpGrp(array):
	i = 0
	previous = array[0]
	for a in array:
		exist = maya.cmds.objExists(a)
		if(exist == False ):
			maya.cmds.group(em=True,n=a,w=True)
			if(i > 0 ):
				maya.cmds.parent(a,previous,r=True)
		i = i + 1
		previous = a

def filterSelection2(array,breakerObj,increment):
	newArray = []
	brake = False
	print ('breakerObj = ' + str(breakerObj) )
	#for n in array:
	for n in range(0,len(array),increment):
		if(brake == False):
			newArray.append(array[n])
			if(array[n] == breakerObj):
				print ('array[n] =  ' + str(breakerObj) )
				brake = True
	print ('newArray = ' + str(newArray) )
	return newArray
	
def createIKjoints(jointArray,sidePrefix,jointType,group):
	newArray = []
	#brake = False
	endJoint = jointArray[len(jointArray)-1]
	print('endJoint = ' + str(endJoint))
	maya.cmds.select( clear=True )
	duplicate = maya.cmds.duplicate(jointArray[0])[0]
	maya.cmds.makeIdentity( duplicate, apply=True, t=0, r=1, s=0, n=0 )
	maya.cmds.parent(duplicate, w=True)
	howManyJoints = len(jointArray)
	for i in range(0,len(jointArray),1):
		n = findNamePrefix(jointArray[i],sidePrefix)
		newn = sidePrefix + jointType + n
		print('duplicate = ' + str(duplicate))
		j = maya.cmds.rename(duplicate,newn)
		newArray.append(j)
		child = maya.cmds.listRelatives(j,c=True,f=True)
		if(child != None):
			if(len(child) == 1):
				duplicate = child[0]
			else:
				print('child = ' + str(child))
				print(str(j) + ' has a branch of Multiple Joints')
				for c in child:
					print('c = ' + str(c))
					gc = maya.cmds.listRelatives(c,c=True,ad=True,f=True)
					print('gc = ' + str(gc))
					if(gc != None):
						for g in gc:
							prefixToIgnore = g.rfind('|')
							test = g[prefixToIgnore+1:len(g)]
							print('test = ' + str(test))
							if(test == endJoint):
								print('c has the end joint = ' + str(c))
								duplicate = c
								print('duplicate = ' + str(duplicate))
					else:	
						print('deleting ' + str(c))
						maya.cmds.delete(c)

	last = newArray[len(newArray)-1]
	c = maya.cmds.listRelatives(last,c=True,f=True)
	if(c != None):
		for n in c:
			maya.cmds.delete(n)
	maya.cmds.parent(newArray[0],group[len(group)-1])
	return newArray
							
def createIKhandles(prefix,limbType,type,startJoint,endJoint,pvCtrl,curve,grp):
	ikh = prefix + limbType + 'ikHandle'
	if(type != 'ikSplineSolver'):
		h = maya.cmds.ikHandle(n = ikh, sj = startJoint, ee = endJoint, sol = type)
		print('h = ' + str(h))
		if(type == 'ikRPsolver'):
			maya.cmds.poleVectorConstraint( pvCtrl, ikh )
	else:
		h = maya.cmds.ikHandle(n = ikh, sj = startJoint, ee = endJoint, sol = type, ccv = False, c = curve)
		print('h = ' + str(h))
		print('createIKhandles :: grp = ' + str(grp) )
		maya.cmds.parent(h[0],grp)
				
	return h

def getTweenJoints(jointArray,howManyTweenJoints):
	increment = 0
	newArray = []
	#print('getTweenJoints :: increment = ' + str(increment) )
	print('jointArray = ' + str(jointArray) )
	for j in range(0,len(jointArray),1):
		print('getTweenJoints :: j = ' + str(j) )
		if( j == increment ):
			increment = increment + howManyTweenJoints + 1
			print('getTweenJoints :: increment = ' + str(increment) )
		else:
			newArray.append(jointArray[j])
			print('getTweenJoints :: newArray = ' + str(newArray) )

	return newArray

def getShapeNodes(obj):
	howManyShapes = 0
	getShape = maya.cmds.listRelatives(obj, shapes=True)
	if(getShape == None):
		print 'ERROR:: getShapeNodes : No Shape Nodes Connected to ' + obj + ' /n'
	else:
		howManyShapes = len(getShape[0])
	return (getShape, howManyShapes)

def aimControlsToJoints(selectedJoint,obj,jointAimAxis):
	maya.cmds.parent(obj,selectedJoint,a=True)
	maya.cmds.setAttr(obj + '.rx', 0 )
	maya.cmds.setAttr(obj + '.ry', 90 )
	maya.cmds.setAttr(obj + '.rz', 0 )
	maya.cmds.parent(obj,w=True,a=True)

def combineArrays(array1,array2):
	print('combineArrays :: array1 = ' + str(array1))
	returnArray = []
	for b in array1:
		returnArray.append(b)
	for a in array2:
		returnArray.append(a)
	print('combineArrays :: array1 = ' + str(array1))
	print('combineArrays :: array2 = ' + str(array2))
	return returnArray

def findNameFromContextArray(array,txt):
	value = None
	for a in array:
		test = a.endswith(txt)
		if(test == True):
			value = a
	return value

def findNameFromContext(name,txt):
	value = None
	test = name.endswith(txt)
	if(test == True):
		value = name
	return value

def checkAttrExist(obj,attr,type,min,max,default,keyable):
	if maya.cmds.attributeQuery( attr, node=obj, exists=True ):
		maya.cmds.deleteAttr(obj, at=attr)
		
	maya.cmds.addAttr(obj, longName=attr, at=type, defaultValue=default, minValue=min, maxValue=max )

	if(keyable == True):
		maya.cmds.setAttr(obj + '.' + attr, e=True, keyable=True)
	else:
		maya.cmds.setAttr(obj + '.' + attr, e=True, keyable=False, channelBox=True)


def setConstraint(contraintType, source, destination, offset, name):
	constraint = None
	type = 'point'
	if(contraintType == 'parent'):
		type = 'parent'
		if(name != None):
			constraint = maya.cmds.parentConstraint(source,destination, mo=offset, name = name)
		else:
			constraint = maya.cmds.parentConstraint(source,destination, mo=offset)
	elif(contraintType == 'point'):
		if(name != None):
			constraint = maya.cmds.pointConstraint(source,destination, mo=offset, name = name)
		else:
			constraint = maya.cmds.pointConstraint(source,destination, mo=offset)
	elif(contraintType == 'orient'):
		if(name != None):
			constraint = maya.cmds.orientConstraint(source,destination, mo=offset, name = name)
		else:
			constraint = maya.cmds.orientConstraint(source,destination, mo=offset)
	else:
		if(name != None):
			constraint = maya.cmds.aimConstraint(source,destination, mo=offset, name = name)
		else:
			constraint = maya.cmds.aimConstraint(source,destination, mo=offset)

	return (constraint,type)

def createArrowCtrl(name,colour,axis,scle):
	maya.cmds.curve(p=[(0,0,-14),(0,0,-14),(-4,0,-10),(-4,0,-10),(-4,0,-10),(-2,0,-10),(-2,0,-10),(-2,0,-10),(-2,0,-2),(-2,0,-2),(-2,0,-2),(-10,0,-2),(-10,0,-2),(-10,0,-2),(-10,0,-4),(-10,0,-4),(-10,0,-4),(-14,0,0),(-14,0,0),(-14,0,0),(-10,0,4),(-10,0,4),(-10,0,4),(-10,0,2),(-10,0,2),(-10,0,2),(-2,0,2),(-2,0,2),(-2,0,2),(-2,0,10),(-2,0,10),(-2,0,10),(-4,0,10),(-4,0,10),(-4,0,10),(0,0,14),(0,0,14),(0,0,14),(4,0,10),(4,0,10),(4,0,10),(2,0,10),(2,0,10),(2,0,10),(2,0,2),(2,0,2),(2,0,2),(10,0,2),(10,0,2),(10,0,2),(10,0,4),(10,0,4),(10,0,4),(14,0,0),(14,0,0),(14,0,0),(10,0,-4),(10,0,-4),(10,0,-4),(10,0,-2),(10,0,-2),(10,0,-2),(2,0,-2),(2,0,-2),(2,0,-2),(2,0,-10),(2,0,-10),(2,0,-10),(4,0,-10),(4,0,-10),(4,0,-10),(0,0,-14),(0,0,-14)],k=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24])
	ctrl = maya.cmds.ls(selection=True)
	print('ctrl = ' + str(ctrl))
	maya.cmds.rename(ctrl,name)
	shpe = getShapeNodes(name)
	print('shpe[0][0] = ' + str(shpe[0][0]))
	maya.cmds.setAttr(str(shpe[0][0]) + '.overrideEnabled',1)
	maya.cmds.setAttr(str(shpe[0][0]) + '.overrideColor', colour)
	maya.cmds.setAttr(str(name) + '.rotate' + str(axis), 90)
	maya.cmds.setAttr(str(name) + '.scaleX', scle)
	maya.cmds.setAttr(str(name) + '.scaleY', scle)
	maya.cmds.setAttr(str(name) + '.scaleZ', scle)
	maya.cmds.makeIdentity( str(name), apply=True, t=1, r=1, s=1 )
	return name
		
def createCurve(objArray,name,grp):
	howManyObjs = len(objArray)
	print ('howManyObjs = ' + str(howManyObjs))
	points =''
	pos1 = (0,0,0)
	for i in range(0,howManyObjs,1):
		print ('i = ' + str(i))
		if(i != 1):
			pos = getWStransform(objArray[i])
			p = '(' + str(pos[0]) + ',' + str(pos[1]) + ',' + str(pos[2]) + ')'
			print('p = ' + str(p))
			if(i != howManyObjs-1):
				p = p + ', '
		else:
			pos1 = getWStransform(objArray[i])
			print('pos1 = ' + str(pos1))
		points = points + p
		print('points = ' + str(points))

	eval('maya.cmds.curve(p=[' + points + '])')
	curve = maya.cmds.ls(selection=True)
	print ('curve = ' + str(curve))
	rename = maya.cmds.rename(curve,name)
	maya.cmds.parent(rename,grp)
	setWStransform(str(rename) + '.cv[1]',pos1)

	#returns name of curve and number of CV's
	return (rename,howManyObjs-1)

def clusterCurve(curve,nme,grp):
	maya.cmds.select(curve + '.cv[*]')
	cvs = maya.cmds.ls(selection=True)
	print ('cvs = ' + str(cvs))
	print('cvs length = ' + str(len(cvs)))
	rf = cvs[0].rfind(':')
	print ('rf = ' + str(rf))
	lenCVs = len(cvs[0])
	print ('lenCVs = ' + str(lenCVs))
	number = int(cvs[0][(rf+1):(lenCVs-1)])
	print ('number = ' + str(number))
	
	listOfClusters = []
	for i in range(0,number+1,1):
		c = maya.cmds.cluster(str(curve) + '.cv[' + str(i) + ']')
		nn = maya.cmds.rename(c[1],nme+str(i+1))
		listOfClusters.append(nn)
		if( grp != None ):
			maya.cmds.parent(nn,grp)

	print ('listOfClusters = ' + str(listOfClusters))
	return listOfClusters

def reverseArray(array):
	print ('reverseArray :: array = ' + str(array))
	retrunArray = []
	for i in range(len(array)-1,-1,-1):
		retrunArray.append(array[i])
	print ('reverseArray :: retrunArray = ' + str(retrunArray))
	return retrunArray


#### END   - Common Methods ###############################################################################################################################################################################

#### START - Insert Extra Joints ##########################################################################################################################################################################
def insertExtraJoints00(selectedJoints,jointTypePrefix,sidePrefix,jointAimAxis,howManyTweenJoints):
	print('insertExtraJoints00 :: selectedJoints = ' + str(selectedJoints))
	maya.cmds.select( clear=True )
	oldMasterJoints = []
	howManySelJoints = len(selectedJoints)
	alljoints = []
	jointsInserted = []
	print('insertExtraJoints00 :: howManySelJoints = ' + str(howManySelJoints))
	for i in range(0,howManySelJoints-1,1):
		print('insertExtraJoints00 :: i = ' + str(i))
		masterJoint = selectedJoints[i]
		alljoints.append(masterJoint)
		print('insertExtraJoints00 :: masterJoint = ' + str(masterJoint))
		print('insertExtraJoints00 :: selectedJoints[i] = ' + str(selectedJoints[i]))
		t = maya.cmds.rename(selectedJoints[i],'temp_' + masterJoint)
		oldMasterJoints.append(t)
		print('insertExtraJoints00 :: oldMasterJoints = ' + str(oldMasterJoints))
		getOldMasterJointPos = getWStransform(oldMasterJoints[i])
		masterJointName = findName(masterJoint,sidePrefix)
		translateAxis = '.t' + jointAimAxis
		jointDistance = getDistance2Vectors(oldMasterJoints[i],selectedJoints[i+1])
		jointTweendistance = jointDistance / (howManyTweenJoints + 1)
		getMasterJointPos = getWStransform(oldMasterJoints[i])
		previousJoint = maya.cmds.joint( n=masterJoint)

		for j in range(1,howManyTweenJoints+1,1):
			v = incrementPos(jointTweendistance,(j-1)*jointTweendistance,jointAimAxis)
			previousJoint = maya.cmds.joint( previousJoint,n=sidePrefix + jointTypePrefix[i] + str(j), p=v )
			alljoints.append(previousJoint)
			jointsInserted.append(previousJoint)

		setWStransform(masterJoint,getOldMasterJointPos)

		if(jointAimAxis == 'x'):
			aim = maya.cmds.aimConstraint( str(selectedJoints[i+1]), masterJoint, skip=["x"] )
			maya.cmds.delete(aim)
		elif(jointAimAxis == 'y'):
			aim = maya.cmds.aimConstraint( str(selectedJoints[i+1]), masterJoint, skip=["y"] )
			maya.cmds.delete(aim)
		else:
			aim = maya.cmds.aimConstraint( str(selectedJoints[i+1]), masterJoint, skip=["z"] )
			maya.cmds.delete(aim)
	
		setJointOriention(masterJoint)
		parent = maya.cmds.listRelatives( oldMasterJoints[i], parent=True )
		if(len(parent) != None):
			maya.cmds.parent(masterJoint,parent[0])
		
		maya.cmds.parent(selectedJoints[i+1],previousJoint)
		maya.cmds.delete(oldMasterJoints[i])
		maya.cmds.select( clear=True )

	alljoints.append(selectedJoints[howManySelJoints-1])
	print('insertExtraJoints00 :: alljoints = ' + str(alljoints))
	print('insertExtraJoints00 :: jointsInserted = ' + str(jointsInserted))
	return(jointsInserted,alljoints)
	

def insertExtraJoints06(jointArray,howManyJointsInserted,sidePrefix,prefix,suffix,jointAimAxis,jointOrientAxis):
	jointsInserted = []
	allJoints = []
	print('insertExtraJoints06 :: howManyJointsInserted = ' + str(howManyJointsInserted))
	print('insertExtraJoints06 :: jointArray = ' + str(jointArray))
	
	howManyJoints = len(jointArray)
	jointRadius = maya.cmds.getAttr(jointArray[0] + '.radius')

	PosOrNeg = 1

	if(sidePrefix == 'L_'):
		PosOrNeg = 1
		#print('LEFT')
	else:
		PosOrNeg = 1
		#print("RIGHT")

	#create the controls
	for i in range(0, howManyJoints-1, 1):
		
		increment = 1
		nextIndex = i + 1
		nextJoint = jointArray[nextIndex]
		print('insertExtraJoints06 :: nextJoint = ' + str(nextJoint))
		currentJoint = jointArray[i]
		print('insertExtraJoints06 :: currentJoint = ' + str(currentJoint))
		previousJoint = jointArray[i]
		print('insertExtraJoints06 :: previousJoint = ' + str(previousJoint))
		translate = maya.cmds.getAttr(nextJoint  + '.t' + jointAimAxis)
		jointSpacing = PosOrNeg * (translate / (howManyJointsInserted+1))
		print('insertExtraJoints06 :: jointSpacing = ' + str(jointSpacing))
		allJoints.append(currentJoint)
		#print('insertExtraJoints06 :: allJoints = ' + str(allJoints))
		for j in range(0,howManyJointsInserted,1):
			print('insertExtraJoints06 :: j = ' + str(j))
			insertJoint = maya.cmds.insertJoint(previousJoint)
			createJoint = maya.cmds.rename(insertJoint,prefix + jointArray[i] + '_' + str(increment)  + suffix)
			jointsInserted.append(createJoint)
			#print('insertExtraJoints06 :: jointsInserted = ' + str(jointsInserted))
			allJoints.append(createJoint)
			#print('insertExtraJoints06 :: allJoints = ' + str(allJoints))
			maya.cmds.setAttr (createJoint + '.t' + jointAimAxis,jointSpacing)
			maya.cmds.setAttr (createJoint + '.radius', jointRadius)
			previousJoint = createJoint
			print('insertExtraJoints06 :: previousJoint = ' + str(previousJoint))
			increment = increment + 1

		maya.cmds.setAttr (nextJoint + '.t' + jointAimAxis,jointSpacing)
		print ('insertExtraJoints06 :: jointsInserted = ' + str(jointsInserted))
		increment = 1

	allJoints.append(nextJoint)
	print('insertExtraJoints06 :: jointsInserted = ' + str(jointsInserted))
	print('insertExtraJoints06 :: allJoints = ' + str(allJoints))
	return (jointsInserted,allJoints)

#### END  - Insert Extra Joints ##########################################################################################################################################################################	
#### START  - SETUP IK SYSTEM   ##########################################################################################################################################################################	
def createRoll(prefix,array,maxRoll,remapCurveValues,jointRollAxis,controlRollAxis,control,invert):
	print('createRoll :: array = ' + str(array))
	print('createRoll :: prefix = ' + str(prefix))
	#maxRoll = 120
	whichAxis = ['X', 'Y', 'Z']

	#cREATE TEMP REMAP SYSTEM
	inputNode = maya.cmds.shadingNode('multiplyDivide',n='rollInput_multiplyDivide' + '1',au=True)
	resultNode = maya.cmds.shadingNode('multiplyDivide',n='rollResult_multiplyDivide' + '1',au=True)
	rollRemapNode = maya.cmds.shadingNode('remapValue',n='roll_remap' + '1',au=True) 
	source =  inputNode + '.outputX'
	desitination =  rollRemapNode + '.inputValue'  

	maya.cmds.connectAttr(source, desitination, force=True)

	source =  rollRemapNode + '.outValue'
	desitination =  resultNode + '.input1X'  

	maya.cmds.connectAttr(source, desitination, force=True)
	i = 0
	for v in remapCurveValues:
		maya.cmds.setAttr(rollRemapNode + '.value[' + str(i) + '].value_Position',v[0])
		maya.cmds.setAttr(rollRemapNode + '.value[' + str(i) + '].value_FloatValue',v[1])
		maya.cmds.setAttr(rollRemapNode + '.value[' + str(i) + '].value_Interp',v[2])
		i = i + 1
	
	maya.cmds.setAttr(rollRemapNode + '.inputMin',0)
	maya.cmds.setAttr(rollRemapNode + '.inputMax',maxRoll)
	maya.cmds.setAttr(rollRemapNode + '.outputMin',0)
	maya.cmds.setAttr(rollRemapNode + '.outputMax',1)

	howManyMultiplyNodes = math.ceil(float(len(array))  / 3.0)
	print('createRoll :: len(array)-1 = ' + str(len(array)-1))
	print('createRoll :: maxRoll = ' + str(maxRoll))
	fraction = maxRoll / (len(array)-1)
	print('createRoll :: fraction = ' + str(fraction))
	increment = 0#maxRoll
	index = 0
	brk = 0
	multiplyNodes = []
	groupNodes = []
	for i in range(0,howManyMultiplyNodes,1):
		rollMult = maya.cmds.shadingNode('multiplyDivide',n=prefix + 'roll_multiplyDivide' + '1',au=True)
		multiplyNodes.append(rollMult)
		for j in range(0,3,1):
			if(brk == 0):
				print('createRoll :: increment = ' + str(increment))
				maya.cmds.setAttr(inputNode + '.input1X', increment * invert)
				result = maya.cmds.getAttr(resultNode + '.outputX')
				print('createRoll ::result = ' + str(result))
				rollGroup = maya.cmds.group(em=True, n=(array[index] + '_ROLL'))
				print('createRoll :: rollGroup = ' + str(rollGroup))
				groupNodes.append(rollGroup)
				maya.cmds.parent(rollGroup,array[index],r=True)
				#loc = maya.cmds.spaceLocator(n=(array[index] + '_LOC'))
				#maya.cmds.parent(loc,rollGroup,r=True)
				maya.cmds.setAttr(rollMult + '.input2' + str(whichAxis[j]), result)
				source =  control + '.rotate' + controlRollAxis
				desitination = rollMult + '.input1' + str(whichAxis[j])
				maya.cmds.connectAttr(source, desitination, force=True)
				source =  rollMult + '.output' + whichAxis[j]
				desitination = rollGroup + '.rotate' + jointRollAxis
				maya.cmds.connectAttr(source, desitination, force=True)
				increment = increment + fraction
				if(index == len(array)-1):
					brk = 1
					print('createRoll ::brk = ' + str(brk))
				index = index + 1
		
	maya.cmds.delete(inputNode)
	maya.cmds.delete(resultNode)
	maya.cmds.delete(rollRemapNode)

	return (multiplyNodes,groupNodes)

def connectRoll(rollArray,array,jointRollAxis):
	whichAxis = ['X', 'Y', 'Z']
	brk = 0
	index = 0
	groupNodes = []
	for i in range(0,len(rollArray),1):
		for j in range(0,3,1):
			if(brk == 0):
				rollGroup = maya.cmds.group(em=True, n=(array[index] + '_ROLL'))
				groupNodes.append(rollGroup)
				maya.cmds.parent(rollGroup,array[index],r=True)
				source =  rollArray[index] + '.output' + whichAxis[j]
				desitination = rollGroup + '.rotate' + jointRollAxis
				maya.cmds.connectAttr(source, desitination, force=True)
				if(index == len(sel)-1):
					brk = 1
					print('createRoll ::brk = ' + str(brk))
				index = index + 1
	
	return groupNodes



def addStiffness(prefix,jointArray,ctrl):
	stiffnessAttr = 'stiffness'
	mainStiffness = ctrl + '.' + stiffnessAttr
	print('mainStiffness = ' + str(mainStiffness))

	doesStiffnessExist = maya.cmds.attributeQuery( stiffnessAttr, node=ctrl, exists=True )
	if( doesStiffnessExist != True):
		maya.cmds.addAttr(ctrl, longName='stiffness', attributeType='double', min=0, max=10, dv=0 )
		maya.cmds.setAttr(mainStiffness,edit=True, keyable=True)

	print('len(jointArray) = ' + str(len(jointArray)))
	if(len(jointArray) != 0):
		stretchNormaliseNode = prefix + 'stretchNormalise_setRange'
		conn = maya.cmds.listConnections( mainStiffness, d=True, s=False, t='setRange' )
		print('conn = ' + str(conn))
		setRangeNode = ''
		if( conn == None ):
			setRangeNode = maya.cmds.shadingNode('setRange',n=stretchNormaliseNode,au=True)
			maya.cmds.setAttr(setRangeNode + '.oldMaxY', 10)
			maya.cmds.setAttr(setRangeNode + '.maxY', 1)
		elif( len(conn) == 1):
			setRangeNode = conn[0]
			print('setRangeNode = ' + str(setRangeNode))
			maya.cmds.setAttr(setRangeNode + '.oldMaxY', 10)
			maya.cmds.setAttr(setRangeNode + '.maxY', 1)
		else:
			print('ERROR :: ' + mainStiffness + ' has too many setRange nodes connected to it!!!')

		socketAttribute1 = '.valueY'
		connectorAttribute1 = '.stiffness'

		connectorAttribute2 = '.outValueY'
		socketAttribute2 = '.stiffness'

		socket1 = setRangeNode + socketAttribute1
		connector1 = mainStiffness
		maya.cmds.connectAttr(connector1, socket1, force=True)

		for i in range(0, len(jointArray), 1):
			connector2 = setRangeNode + connectorAttribute2
	
			socket2 = jointArray[i] + (socketAttribute2 + 'X')
			maya.cmds.connectAttr(connector2, socket2, force=True)
	
			socket2 = jointArray[i] + (socketAttribute2 + 'Y')
			maya.cmds.connectAttr(connector2, socket2, force=True)

			socket2 = jointArray[i] + (socketAttribute2 + 'Z')
			maya.cmds.connectAttr(connector2, socket2, force=True)
	else:
		print('No Tween Joints to connect the Stiffness attribute')

def setUpIKFKswitch(prefix,array,ctrl,ik,fk):
	checkAttrExist(ctrl,'IkFk','double',0,10,0,True)
	print('setUpIKFKswitch :: prefix = ' + str(prefix))
	print('setUpIKFKswitch :: array = ' + str(array))
	print('setUpIKFKswitch :: ctrl = ' + str(ctrl))
	setRangeNode = maya.cmds.shadingNode('setRange',n=prefix + 'IKFK_setRange',au=True)
	maya.cmds.setAttr(setRangeNode + '.oldMinX',10)
	maya.cmds.setAttr(setRangeNode + '.oldMinY',0)
	maya.cmds.setAttr(setRangeNode + '.oldMaxX',0)
	maya.cmds.setAttr(setRangeNode + '.oldMaxY',10)
	maya.cmds.setAttr(setRangeNode + '.minX',1)
	maya.cmds.setAttr(setRangeNode + '.minY',0)
	maya.cmds.setAttr(setRangeNode + '.maxX',0)
	maya.cmds.setAttr(setRangeNode + '.maxY',1)

	socket =  setRangeNode + '.valueX'
	connector =  ctrl + '.IkFk'  
	maya.cmds.connectAttr(connector, socket, force=True)
	socket =  setRangeNode + '.valueY'
	maya.cmds.connectAttr(connector, socket, force=True)
	
	for c in array:
		print('setUpIKFKswitch :: c[0][0] = ' + str(c[0][0]))
		attr = maya.cmds.listAttr( c[0][0] )
		print('setUpIKFKswitch :: attr = ' + str(attr))
		conn1 = None
		conn2 = None
		for i in range(len(attr)-1,len(attr)-6,-1):
			#print('setUpIKFKswitch :: i = ' + str(i))
			#print('setUpIKFKswitch :: attr[i] = ' + str(attr[i]))
			conn1 = findNameFromContext(attr[i],'W0')
			print('setUpIKFKswitch :: conn1 = ' + str(conn1))	
			if(conn1 != None):
				break

		for i in range(len(attr)-1,len(attr)-6,-1):
			conn2 = findNameFromContext(attr[i],'W1')
			print('setUpIKFKswitch :: conn2 = ' + str(conn2))
			if(conn2 != None):
				break

		if(conn1 != None):
			if(ik == True):
				socket = c[0][0] + '.' + conn1
				print('setUpIKFKswitch :: socket = ' + str(socket))
				connector =  setRangeNode + '.outValueX'
				maya.cmds.connectAttr(connector, socket, force=True)
				if(fk == True):
					if(conn2 != None):
						socket = c[0][0] + '.' + conn2
						connector =  setRangeNode + '.outValueY'
						maya.cmds.connectAttr(connector, socket, force=True)
		else:
			if(fk == True):
				maya.cmds.setAttr(ctrl + '.IkFk',10)
				socket = c[0][0] + '.' + conn1
				connector =  setRangeNode + '.outValueY'
				maya.cmds.connectAttr(connector, socket, force=True)

				
		

def setUpIKstretch(prefix,jointAimAxis,limbTypeName,ikJointArray,howManyNodes,mainCtrl,startCTRL,endCTRL,ikHndle,dimGroup):
	#select second and last joint of Ik Chain, then the ctrl
	howManyJoints = len(ikJointArray)
	
	autoSwitchAttr = '.autoStretchIK'#must be boolean
	stretchIKAttr = '.stretchIK'
	stretchNormaliseNode = prefix + 'stretchNormalise_setRange'

	IKNormaliseNode = prefix + 'normalize_multiplyDivide'
	IKMultiplierNode = prefix + 'multiplier_multiplyDivide'
	IKConditionNode = prefix + 'autoStretch_condition'
	IKScaleLimiterNode = prefix + 'limit_multiplyDivide'
	IKAutoStretchBlendNode = prefix + 'autoStretch_blend'
	IKStretchBlendNode = prefix + 'stretch_blend'
	IKStretchDampener = prefix + 'StretchDampener_condition'
	IKStretchRemapNode = prefix + 'stretchDampenRemap_remapValue'
	IKStretchBlendNode = prefix + 'stretchDampenBlend_blend'
	IKDampenValueNode = prefix + 'DampenValue_multiplyDivide'
	dampenAmount = 0.960

	startJoint = ikJointArray[0]
	print('setUpIKstretch :: startJoint = ' + str(startJoint))
	endJoint = ikJointArray[len(ikJointArray)-1]
	print('setUpIKstretch :: endJoint = ' + str(endJoint))

	distanceName = prefix + 'distanceDimension1'

	distanceNode = maya.cmds.distanceDimension( sp=(-2, 0, 0), ep=(2, 0, 0) )
	
	print('setUpIKstretch :: dimGroup = ' + str(dimGroup))
	maya.cmds.parent(distanceNode,dimGroup)
	distanceTrans = maya.cmds.listRelatives(distanceNode,p=True,f=True)
	distLocators = maya.cmds.listConnections(distanceNode,t='locator')
	print('setUpIKstretch :: distLocators = ' + str(distLocators))
	startLoc = maya.cmds.rename(distLocators[0],prefix + 'start_dim_LOC')
	endLoc = maya.cmds.rename(distLocators[1],prefix + 'end_dim_LOC')
	startLocPos = getWStransform(startJoint)
	setWStransform(startLoc,startLocPos)
	endLocPos = getWStransform(endJoint)
	setWStransform(endLoc,endLocPos)
	distanceName = maya.cmds.rename(distanceTrans[0],distanceName)
	print('setUpIKstretch :: distanceName = ' + str(distanceName))

	print('setUpIKstretch :: startLoc = ' + str(startLoc))
	print('setUpIKstretch :: startCTRL = ' + str(startCTRL))
	#startParent = None
	if(limbTypeName == 'arm_'):
		maya.cmds.parent(startLoc,startCTRL,a=True)
		maya.cmds.parent(endLoc,ikHndle,a=True)
	else:
		endParent = maya.cmds.parentConstraint(endLoc,endCTRL,mo=True)
		maya.cmds.delete(endParent)
		print('setUpIKstretch :: endLoc = ' + str(endLoc))
		print('setUpIKstretch :: mainCtrl = ' + str(mainCtrl))
		maya.cmds.parent(endLoc,mainCtrl,a=True)
		#startParent = maya.cmds.parentConstraint(startLoc,startCTRL,mo=True)
		maya.cmds.parentConstraint(startLoc,startCTRL,mo=True)
	
	
	#START///////////////////////////////////CREATE CONDITION, NORMALISE MULTIPLYDIVIDE NODE AND 
	#START///////////////////////////////////CONNECT THE DISTANCE NODES DISTANCE ATTRIBUTE TO NORMALISE MULTIPLYDIVIDE NODES INPUT1X 
	#START///////////////////////////////////CONNECT THE NORMALISE MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE
	
	#create set range node to normalise the stretch IK attribute*********************START**********create set range node to normalise the stretch IK attribute
	setRangeNode = maya.cmds.shadingNode('setRange',n=stretchNormaliseNode,au=True)
	connector = mainCtrl + stretchIKAttr
	socket = setRangeNode + '.valueX'
	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(setRangeNode + '.oldMaxX', 10)
	maya.cmds.setAttr(setRangeNode + '.maxX', 1)
	#create set range node to normalise the stretch IK attribute*********************END**********create set range 
	
	#CREATE NORMALISE MULTIPLYDIVIDE NODE************************************************************START**********CREATE NORMALISE MULTIPLYDIVIDE NODE
	normaliseNode = maya.cmds.shadingNode('multiplyDivide',n=IKNormaliseNode + '1',au=True)
	connector = distanceName + '.distance'
	socket = normaliseNode + '.input1X'
	maya.cmds.connectAttr(connector, socket, force=True)

	#SET INPUT2X TO DISTANCE VALUE AND SET **************************************************************START**********SET INPUT2X TO DISTANCE VALUE AND SET 
	#MULTIPLYDIVIDE NODES OPERATION TO DIVIDE************************************************************START**********MULTIPLYDIVIDE NODES OPERATION TO DIVIDE
	socketAttribute = '.input2X'

	maya.cmds.setAttr(normaliseNode + '.operation', 2)
	distance = maya.cmds.getAttr(connector)
	print ('setUpIKstretch :: distance = ' + str(distance))

	maya.cmds.setAttr(normaliseNode + socketAttribute, distance) 
	#set Normalise nodes Z output to 1; ie 1 / 1 = 1. This will be connected to $stretch input 1R
	maya.cmds.setAttr(normaliseNode + '.input1Z', 1)
	maya.cmds.setAttr(normaliseNode + '.input2Z', 1)

	#SET INPUT2X TO DISTANCE VALUE AND SET **************************************************************END**********SET INPUT2X TO DISTANCE VALUE AND SET 
	#MULTIPLYDIVIDE NODES OPERATION TO DIVIDE************************************************************END**********MULTIPLYDIVIDE NODES OPERATION TO DIVIDE

	#CREATE NORMALISE MULTIPLYDIVIDE NODE************************************************************END**********CREATE NORMALISE MULTIPLYDIVIDE NODE

	stretchRemapNode = maya.cmds.shadingNode('remapValue',n=IKStretchRemapNode + '1',au=True) 
	socket =  stretchRemapNode + '.inputValue'
	connector =  normaliseNode + '.outputX'  

	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(stretchRemapNode + '.value[0].value_Position',0.0)
	maya.cmds.setAttr(stretchRemapNode + '.value[0].value_FloatValue',0.0)
	maya.cmds.setAttr(stretchRemapNode + '.value[0].value_Interp',2)

	maya.cmds.setAttr(stretchRemapNode + '.value[1].value_Position',1.0)
	maya.cmds.setAttr(stretchRemapNode + '.value[1].value_FloatValue',0.0)
	maya.cmds.setAttr(stretchRemapNode + '.value[1].value_Interp',2)

	maya.cmds.setAttr(stretchRemapNode + '.value[2].value_FloatValue',1.0)
	maya.cmds.setAttr(stretchRemapNode + '.value[2].value_Position',0.5)
	maya.cmds.setAttr(stretchRemapNode + '.value[2].value_Interp',2)

	maya.cmds.setAttr(stretchRemapNode + '.inputMin',0)
	maya.cmds.setAttr(stretchRemapNode + '.inputMax',2)

	StretchBlendNode = maya.cmds.shadingNode('blendColors',n=IKStretchBlendNode + '1',au=True) 

	socket =  StretchBlendNode + '.blender'
	connector =  stretchRemapNode + '.outValue'  

	maya.cmds.connectAttr(connector, socket, force=True)

	dampenValueNode = maya.cmds.shadingNode('multiplyDivide',n=IKDampenValueNode + '1',au=True) 
	
	maya.cmds.setAttr(dampenValueNode + '.input1X',dampenAmount)
	maya.cmds.setAttr(dampenValueNode + '.input1Y',1)
	socket = StretchBlendNode + '.color2R'
	connector = dampenValueNode + '.outputX'   

	maya.cmds.connectAttr(connector, socket, force=True)

	socket = StretchBlendNode + '.color1R'
	connector = dampenValueNode + '.outputY'   

	maya.cmds.connectAttr(connector, socket, force=True)

	stretchDampenerNode = maya.cmds.shadingNode('condition',n=IKStretchDampener + '1',au=True) 
	socket =  stretchDampenerNode + '.firstTerm'
	connector =  StretchBlendNode + '.outputR'  

	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(stretchDampenerNode + '.operation',0)
	maya.cmds.setAttr(stretchDampenerNode + '.secondTerm',1)
	maya.cmds.setAttr(stretchDampenerNode + '.colorIfTrueR',1)
	
	socket =  stretchDampenerNode + '.colorIfFalseR'
	connector =  StretchBlendNode + '.outputR'  

	maya.cmds.connectAttr(connector, socket, force=True)

	#??????????????????????????THIS IS REDUNDANT??????????????????????????????
	#START/////////////////////////////////////////////////////////////CREATE LIMITER MULTIPLYDIVIDE NODE
	limiterNode = maya.cmds.shadingNode('multiplyDivide',n=IKScaleLimiterNode + '1',au=True) 
	
	IKScaleLimiterNode = limiterNode

	#CONNECT NORMALISE MULTIPLYDIVIDE NODES OUPUTX TO ".colorIfFalseR" OF CONDITION NODE
	socket = limiterNode + '.input2X'
	connector = stretchDampenerNode + '.outColorR'   

	maya.cmds.connectAttr(connector, socket, force=True)

	socket = limiterNode + '.input1X'
	connector = normaliseNode + '.outputX'   

	maya.cmds.connectAttr(connector, socket, force=True)

	#END//////////////////////////////////////////////////////////////CREATE LIMITER MULTIPLYDIVIDE NODE
	#??????????????????????????THIS IS REDUNDANT??????????????????????????????

	#CREATE CONDITION NODE AND CONNECT NORMALISE ********************************************START********CREATE CONDITION NODE AND CONNECT NORMALISE 
	#MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE*******************************START********MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE
	conditionNode = maya.cmds.shadingNode('condition',n=IKConditionNode + '1',au=True) 
	socket =  conditionNode + '.firstTerm'
	connector =  normaliseNode + '.outputX'  

	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(conditionNode + '.operation',4)
	maya.cmds.setAttr(conditionNode + '.secondTerm',1)
	maya.cmds.setAttr(conditionNode + '.colorIfTrueR',1)

	#CONNECT NORMALISE MULTIPLYDIVIDE NODES OUPUTX TO ".colorIfFalseR" OF CONDITION NODE
	socket = conditionNode + '.colorIfFalseR'
	connector = IKScaleLimiterNode + '.outputX'   

	maya.cmds.connectAttr(connector, socket, force=True)

	#CREATE CONDITION NODE AND CONNECT NORMALISE ********************************************END********REATE CONDITION NODE AND CONNECT NORMALISE 
	#MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE*******************************END********MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE

	#CREATE AUTO STETCH ON AND OFF NODE********************************************START********CREATE AUTO STETCH ON AND OFF NODE
	#connect waist CTRL auto switch to the first term
	connector = mainCtrl + autoSwitchAttr
	socket = setRangeNode + '.valueY'
	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(setRangeNode + '.oldMaxY', 10)
	maya.cmds.setAttr(setRangeNode + '.maxY', 1)

	autoStretch = maya.cmds.shadingNode('blendColors',n=IKAutoStretchBlendNode + '1',au=True) 
	socket = autoStretch + '.blender' #waist CTRL attribute auto stretch via set Range
	connector = setRangeNode + '.outValueY' 
	maya.cmds.connectAttr(connector, socket, force=True)

	#from auto stretch condition node;  $conditionNode 
	socket = autoStretch + '.color1R'
	connector = conditionNode + '.outColorR'
	maya.cmds.connectAttr(connector, socket, force=True)

	#from stretch  node;  $stretch 
	socket = autoStretch + '.color2R'
	connector = IKScaleLimiterNode + '.outputX'
	maya.cmds.connectAttr(connector, socket, force=True)
	#CREATE AUTO STETCH ON AND OFF NODE********************************************END********CREATE AUTO STETCH ON AND OFF NODE

	#CREATE STRETCH ON AND OFF NODE**************************************************************START*******************CREATE STRETCH ON AND OFF NODE
	stretch =  maya.cmds.shadingNode('blendColors',n=IKStretchBlendNode + '1',au=True) 
	socket = stretch + '.color2R'
	connector = normaliseNode + '.outputZ'
	maya.cmds.connectAttr(connector, socket, force=True)
	
	socket = stretch + '.color1R'
	connector =  autoStretch + '.outputR'
	maya.cmds.connectAttr(connector, socket, force=True)

	#connect $setRangeNode .outpUtX to $stretch blend input
	socket =  stretch + '.blender'
	connector =  setRangeNode + '.outValueX'
	maya.cmds.connectAttr(connector, socket, force=True)

	#CREATE STRETCH ON AND OFF NODE**************************************************************END*******************CREATE STRETCH ON AND OFF NODE

	IKConditionNode = conditionNode
	IKNormaliseNode = normaliseNode
	IKAutoStretchBlendNode = autoStretch
	IKStretchBlendNode = stretch
	stretchNormaliseNode = setRangeNode

	#END///////////////////////////////////CREATE CONDITION, NORMALISE MULTIPLYDIVIDE NODE AND 
	#END///////////////////////////////////CONNECT THE DISTANCE NODES DISTANCE ATTRIBUTE TO NORMALISE MULTIPLYDIVIDE NODES INPUT1X 
	#END///////////////////////////////////CONNECT THE NORMALISE MULTIPLYDIVIDE NODES OUPUTX TO 1st TERM OF CONDITION NODE

	#START/////////////////////////////////////////////////////////////MULTIPLIER NODES READY TO BE CONNECT RO IK JOINT TRANSLATEX
	multiplierNodes = []
	for i in range(0,howManyNodes,1):
		multiplierNode = maya.cmds.shadingNode('multiplyDivide',n=IKMultiplierNode + '1',au=True)
		#multiplierNodes[i] = multiplierNode
		multiplierNodes.append(multiplierNode)

	#END///////////////////////////////////////////////////////////////MULTIPLIER NODES READY TO BE CONNECT RO IK JOINT TRANSLATEX

	#START/////////////////////////////////////////////////////////////CONNECT THE CONDITION NODE TO MULTIPLIER NODES READY TO BE CONNECT TO IK JOINT TRANSLATEX
	connectorAttribute1 = '.outputR'
	socketAttribute1 = '.input' 
	connector1 = IKStretchBlendNode + connectorAttribute1

	connectorAttribute2 = '.output'

	whichJoint = 1
	brake = 0

	#CONNECT CONDITION NODE TO MULYIPLIER NODES
	for i in range(0,howManyNodes,1):
		multiply = i + 1 #use to select the right joint in $sel[] and "spine_multiplier_multiplyDivide" node
	
		whichAxis = [' ', 'X', 'Y', 'Z']
		for j in range(1,4,1):
			if(brake == 0):
				socket1 = multiplierNodes[i] + (socketAttribute1 + '2' + whichAxis[j])
				maya.cmds.connectAttr(connector1, socket1, force=True)
		
				getAttr = maya.cmds.getAttr(ikJointArray[whichJoint] + '.t' + jointAimAxis)
				setAttr = maya.cmds.setAttr(multiplierNodes[i] + (socketAttribute1 + '1' + whichAxis[j]), getAttr)
		
				connector2 = IKMultiplierNode + str(multiply) + (connectorAttribute2 + whichAxis[j])
				socket2 = (ikJointArray[whichJoint] + '.t' + jointAimAxis)
				maya.cmds.connectAttr(connector2, socket2, force=True)

				whichJoint = whichJoint + 1
	
				print ('setUpIKstretch :: whichJoint = ' + str(whichJoint))
				print ('setUpIKstretch :: howManyJoints = ' + str(howManyJoints))

				#LOOP BREAK TO CATER FOR ODD NUMBER OF JOINTS
				if(whichJoint == howManyJoints):
					brake = 1
	
		print ('setUpIKstretch :: i = ' + str(i) )

	#END//////////////////////////////////////////////////////////////CONNECT THE CONDITION NODE TO MULTIPLIER NODES READY TO BE CONNECT TO IK JOINT TRANSLATEX
	#================================================================================================================================
	#END++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

	#^^^^^^^^^^^^^^^-----TESTED AND WORKS-----^^^^^^^^^^^^^^^!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

def buildIKfootRig(prefix,deleteHeelJoint,jointArray,howManyJoints,heelLocOffset,pitchAxis,rotateAxis,rollAxis,mainCTRL):
	#Find the position for foot, ball, toe and store them
	#Instructions:
	#1.Create a IK foot Rig that has a ankle joint, ball joint, toe joint heading off in front and finally a temporary joint called "_toDelete_heel",
	######that branches from the ankle down to where the heel of the geo meets the ground.
	#2.Select the ankle joint and run script

	#def createIKfootLocator(name,howManyJoints,jointArray):
	#	name = 'tipToe_LOC'
	#	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	#	whichJointLocation = howManyJoints - 2 #//////////////////////////////////////select tip Toe///////NEEDS TO BE UPDATED
	#	whichJoint = jointArray[whichJointLocation]
	#	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), skip="y", weight=1 )
	#	maya.cmds.delete(constainLocator)

	print('howManyJoints = ' + str(howManyJoints))

	#tipToe locator and position it**************************************************************START*******tipToe locator & position it
	name = 'tipToe_LOC'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = howManyJoints - 1 #//////////////////////////////////////select tip Toe///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), skip="y", weight=1 )
	maya.cmds.delete(constainLocator)
	tipToe = createLocator[0]
	#tipToe locator and position it**************************************************************END*********tipToe locator & position it

	previousLocator = createLocator[0]

	#heel locator and position it******************************************************************START*******heel locator & position it
	name = 'heel_LOC'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = 0 #///////////////////////////////////////////////////////////////select foot///////NEEDS TO BE UPDATED
	whichJoint = deleteHeelJoint #"_toDelete_heel"------------------->//OLD CODE//$jointArray[$whichJointLocation];
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), skip="y", weight=1 )
	maya.cmds.delete(constainLocator)
	heel = createLocator[0]
	#heel locator and position it******************************************************************END*******heel locator & position it

	currentLocator = createLocator[0]

	#BREAK OFFSET HEEL LOC#######################################################################################################START

	#offset position of heel*************************************************************************START*****offset position of heel
	getCurrentLocatorPos = maya.cmds.getAttr(currentLocator + '.translateZ') #////////////////////////////////NEEDS TO BE GLOBALISED
	currentPos = getCurrentLocatorPos
	offset = heelLocOffset #//////////////////////////////////////////////////////////////////////////////////////NEEDS TO BE GLOBALISED
	offsetCurrentLocator = currentPos - offset
	setCurrentLocatorPos = maya.cmds.setAttr(currentLocator + '.translateZ', offsetCurrentLocator) #//////////NEEDS TO BE GLOBALISED
	#offset position of heel**************************************************************************END******offset position of heel

	#BREAK OFFSET HEEL LOC#######################################################################################################END

	maya.cmds.parent(currentLocator, previousLocator, a=True)
	previousLocator = createLocator[0]

	#ball locator 1 & position it**********************************************************************START*****ball locator 1 & position it
	name = 'roll_LOC1'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = howManyJoints - 2 #////////////////////////////////////////select tip Toe///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), weight=1 )
	maya.cmds.delete(constainLocator)
	roll = createLocator[0]
	#ball locator 1 & position it**********************************************************************END*****ball locator 1 & position it

	currentLocator = createLocator[0]
	branchPoint = currentLocator #///////////////////////////////////////////slect branch point/////////////////////NEEDS TO BE UPDATED
	maya.cmds.parent(currentLocator, previousLocator, a=True)
	previousLocator = createLocator[0]

	#ball locator 2 & position it**********************************************************************START*****ball locator 2 & position it
	name = 'ball_LOC1'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = howManyJoints - 2 #//////////////////////////////////////select ball///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), weight=1 )
	maya.cmds.delete(constainLocator)
	ball = createLocator[0]
	#ball locator 2 & position it**********************************************************************END*****ball locator 2 & position it

	currentLocator = createLocator[0]
	
	maya.cmds.parent(currentLocator, previousLocator, a=True)
	previousLocator = createLocator[0]

	#ankle locator & position it**********************************************************************START*****ankle locator & position it
	name = 'ankle_LOC1'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = 0 #////////////////////////////////////////select foot///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), weight=1 )
	maya.cmds.delete(constainLocator)
	#ankle locator & position it**********************************************************************END*****ankle locator & position it

	currentLocator = createLocator[0]
	maya.cmds.parent(currentLocator, previousLocator, a=True)
	previousLocator = createLocator[0]
	
	#BREAK AND GO BACK TO BALL LOC 1#####################################################################################################START

	#toe locator 1 & position it**********************************************************************START*****toe locator & position it
	name = 'toe_LOC1'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = howManyJoints - 2 #////////////////////////////////////////select foot///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), weight=1 )
	maya.cmds.delete(constainLocator)
	toe = createLocator[0]
	#toe locator 1 & position it**********************************************************************END*****toe locator & position it

	currentLocator = createLocator[0]
	maya.cmds.parent(currentLocator, branchPoint, a=True) #////////////////////////////////////////select ball 2///////NEEDS TO BE UPDATED
	previousLocator = createLocator[0]

	#toe locator 2 & position it**********************************************************************START*****toe locator & position it
	name = 'toe_LOC2'
	createLocator = maya.cmds.spaceLocator(n=prefix + name, p=(0,0,0))
	whichJointLocation = howManyJoints - 1 #//////////////////////////////////////select tip Toe///////NEEDS TO BE UPDATED
	whichJoint = jointArray[whichJointLocation]
	constainLocator = maya.cmds.pointConstraint(whichJoint, createLocator, offset=(0, 0, 0), weight=1 )
	maya.cmds.delete(constainLocator)
	#toe locator 2 & position it**********************************************************************END*****toe locator & position it

	currentLocator = createLocator[0]
	maya.cmds.parent(currentLocator, previousLocator, a=True) #//////////////////////////////////////////select toe 1///////NEEDS TO BE UPDATED
	previousLocator = createLocator[0]

	#CONNECT AND CREATE ATTRIBUTES TO MAIN CONTROL
	checkAttrExist(mainCTRL,'heelUp','double',-90,90,0,True)
	source = mainCTRL + '.heelUp'
	destination = heel + '.rotate' + pitchAxis
	maya.cmds.connectAttr(source, destination, force=True)
	checkAttrExist(mainCTRL,'heelSide','double',-90,90,0,True)
	source = mainCTRL + '.heelSide'
	destination = heel + '.rotate' + rotateAxis
	maya.cmds.connectAttr(source, destination, force=True)

	checkAttrExist(mainCTRL,'ballUp','double',-90,90,0,True)
	source = mainCTRL + '.ballUp'
	destination = ball + '.rotate' + pitchAxis
	maya.cmds.connectAttr(source, destination, force=True)
	checkAttrExist(mainCTRL,'ballSide','double',-90,90,0,True)
	source = mainCTRL + '.ballSide'
	destination = ball + '.rotate' + rotateAxis
	maya.cmds.connectAttr(source, destination, force=True)

	checkAttrExist(mainCTRL,'toeUp','double',-90,90,0,True)
	source = mainCTRL + '.toeUp'
	destination = toe + '.rotate' + pitchAxis
	maya.cmds.connectAttr(source, destination, force=True)

	checkAttrExist(mainCTRL,'tipToeUp','double',-180,180,0,True)
	source = mainCTRL + '.tipToeUp'
	destination = tipToe + '.rotate' + pitchAxis
	maya.cmds.connectAttr(source, destination, force=True)
	checkAttrExist(mainCTRL,'tipToeSide','double',-90,90,0,True)
	source = mainCTRL + '.tipToeSide'
	destination = tipToe + '.rotate' + rotateAxis
	maya.cmds.connectAttr(source, destination, force=True)

	checkAttrExist(mainCTRL,'footRoll','double',-90,90,0,True)
	source = mainCTRL + '.footRoll'
	destination = roll + '.rotate' + rollAxis
	maya.cmds.connectAttr(source, destination, force=True)

	return (prefix + 'tipToe_LOC',prefix + 'ankle_LOC1')

def masterCreateIK(sidePrefix,jointType,limbType,limbTypeName,upAxis,jointAimAxis,tweenJoints,startJoint,midJoint,endJoint,toeJoint,mainCtrl,startCtrl,endCtrl,pvCtrl,ikfkSwitch,heelJoint):
	prefix = sidePrefix + jointType

	groupSkeleton = ['char_GRP','DO_NOT_ALTER_GRP','skeleton_scale_GRP','CTRL_skeleton_GRP']
	groupDim = ['char_GRP','DO_NOT_ALTER_GRP','dimension_GRP']
	skeletonCtrlGrp = groupSkeleton[3]

	#ENSURE THAT KEY ATTRIBUTES EXISTS ON THE IKFK SWITCH CONTROL
	checkAttrExist(mainCtrl,'stiffness','double',0,10,0,True)
	checkAttrExist(mainCtrl,'stretchIK','double',0,10,0,True)
	checkAttrExist(mainCtrl,'autoStretchIK','double',0,10,0,True)
	checkAttrExist(mainCtrl,'isolate','double',0,10,0,True)

	#if(len(sel) > 2):
	#	toeJoint = sel[2]
	maya.cmds.select(startJoint)
	maya.cmds.select(hierarchy = True)
	selHi = maya.cmds.ls(selection = True)
	selectedJoints = []
	if(limbTypeName == 'leg_'):
		if(toeJoint == ''):
			print('ERROR :: masterCreateIK :: No toe joint selected')
		else:
			if(jointType == 'Quadraped'):
				selectedJoints = filterSelection2(selHi,endJoint,1)
			else:
				selectedJoints = filterSelection2(selHi,toeJoint,1)
	else:
		selectedJoints = filterSelection2(selHi,endJoint,1)
	print('masterCreateIK :: selectedJoints = ' + str(selectedJoints))
		
	maya.cmds.select(clear=True)

	setUpGrp(groupSkeleton)
	setupPolVector(pvCtrl,midJoint,0,upAxis)

	#ikJoints are only the joints that make up the IKPhandle chain
	ikJoints = createIKjoints(selectedJoints,sidePrefix,jointType,groupSkeleton)
	print('masterCreateIK :: ikJoints = ' + str(ikJoints))
	print('masterCreateIK :: pvCtrl = ' + str(pvCtrl))
	ej = prefix + findNamePrefix(endJoint,sidePrefix)
	print('masterCreateIK :: ej = ' + str(ej))
	ikHandleType = 'ikSCsolver'
	if maya.cmds.objExists(pvCtrl):
		ikHandleType = 'ikRPsolver'
	mainIkhandle = createIKhandles(prefix,limbTypeName,ikHandleType,ikJoints[0],ej,pvCtrl,None,None)
	print('masterCreateIK :: mainIkhandle = ' + str(mainIkhandle))
	grp = maya.cmds.listRelatives(pvCtrl,p=True,type='transform')
	print('masterCreateIK :: grp = ' + str(grp))
	
		
	if(limbTypeName == 'leg_'):

		if(grp != None):
			maya.cmds.parent(grp[0],mainCtrl,a=True)
		else:
			maya.cmds.parent(pvCtrl,mainCtrl,a=True)

		footIK = createIKhandles(prefix,'foot-','ikSCsolver',ikJoints[len(ikJoints)-3],ikJoints[len(ikJoints)-2],False,None,None)
		print('masterCreateIK :: footIK = ' + str(footIK))
		toeIK = createIKhandles(prefix,'toe_','ikSCsolver',ikJoints[len(ikJoints)-2],ikJoints[len(ikJoints)-1],False,None,None)
		print('masterCreateIK :: toeIK = ' + str(toeIK))
	
		footJoints = [prefix + 'ankle',prefix + 'foot',prefix + 'toe']
		toDelete_heel = heelJoint #sidePrefix + 'toDelete_heel'
		tipToeLoc = buildIKfootRig(prefix,toDelete_heel,footJoints,len(footJoints),0.00,'X','Y','Z',mainCtrl)
		print('masterCreateIK :: tipToeLoc = ' + str(tipToeLoc))
		endCtrl = tipToeLoc[1]
		maya.cmds.parent(toeIK[0], prefix + 'toe_LOC2')
		maya.cmds.parent(footIK[0], prefix + 'ball_LOC1')
		maya.cmds.parent(mainIkhandle[0], prefix + 'ankle_LOC1')
		maya.cmds.parent(tipToeLoc[0],mainCtrl,a=True)
	
	if(limbTypeName == 'arm_'):

		if(grp != None):
			maya.cmds.parent(grp[0],mainIkhandle[0],a=True)
		else:
			maya.cmds.parent(pvCtrl,mainIkhandle[0],a=True)

		maya.cmds.parent(mainIkhandle[0], mainCtrl + '_GRP')
		setConstraint('point', mainCtrl, mainIkhandle[0], True, None)
		setConstraint('orient', ikJoints[len(ikJoints)-1], mainCtrl, True, None)
	
	prefix = sidePrefix + jointType + limbTypeName
	print('masterCreateIK :: prefix = ' + str(prefix))
	ikJointsFiltered = filterSelection2(ikJoints,ej,1)
	print('masterCreateIK :: ikJointsFiltered = ' + str(ikJointsFiltered))
	print('masterCreateIK :: len(ikJointsFiltered) = ' + str(len(ikJointsFiltered)))
	howManyNodes = int(math.ceil(len(ikJointsFiltered) / 3)) #This divided by three because of X,Y,Z
	print('masterCreateIK :: howManyNodes = ' + str(howManyNodes))
	setUpGrp(groupDim)
	setUpIKstretch(prefix,jointAimAxis,limbTypeName,ikJointsFiltered,howManyNodes,mainCtrl,startCtrl,endCtrl,mainIkhandle[0],groupDim[len(groupDim)-1])

	#Add Control over the stiffness of the IK joints
	print('masterCreateIK :: tweenJoints = ' + str(tweenJoints))
	ikTweenJoints = getTweenJoints(ikJoints,tweenJoints)
	print('masterCreateIK :: ikTweenJoints = ' + str(ikTweenJoints))
	addStiffness(sidePrefix + jointType + limbTypeName,ikTweenJoints,mainCtrl)

	return ikJoints


#### END    - SETUP IK SYSTEM   ##########################################################################################################################################################################	
#### START  - SETUP FK SYSTEM   ##########################################################################################################################################################################	
def connectFKControls(limbTypeName,aimAxis,hipCTRL,kneeCTRL,footCTRL,toeCTRL,hipJoint,kneeJoint,footJoint,toeJoint):
	maya.cmds.parentConstraint(hipCTRL,hipJoint,mo=True)
	maya.cmds.pointConstraint(kneeJoint,kneeCTRL,mo=True)
	maya.cmds.pointConstraint(footJoint,footCTRL,mo=True)
	
	#if(aimAxis == 'x'):
	#maya.cmds.connectAttr(str(kneeCTRL) + '.rotate',str(kneeJoint) + '.rotate')
	#maya.cmds.connectAttr(str(hipCTRL) + '.rx',str(hipJoint) + '.ry')
	#maya.cmds.connectAttr(str(hipCTRL) + '.ry',str(hipJoint) + '.rx')
	#maya.cmds.connectAttr(str(hipCTRL) + '.rz',str(hipJoint) + '.rz')

	maya.cmds.connectAttr(str(kneeCTRL) + '.rx',str(kneeJoint) + '.ry')
	maya.cmds.connectAttr(str(kneeCTRL) + '.ry',str(kneeJoint) + '.rx')
	maya.cmds.connectAttr(str(kneeCTRL) + '.rz',str(kneeJoint) + '.rz')

	#maya.cmds.connectAttr(str(footCTRL) + '.rotate',str(footJoint) + '.rotate')
	maya.cmds.connectAttr(str(footCTRL) + '.rx',str(footJoint) + '.ry')
	maya.cmds.connectAttr(str(footCTRL) + '.ry',str(footJoint) + '.rx')
	maya.cmds.connectAttr(str(footCTRL) + '.rz',str(footJoint) + '.rz')
	
	if(limbTypeName == 'leg_'):
		maya.cmds.pointConstraint(toeJoint,toeCTRL,mo=True)
		#maya.cmds.connectAttr(str(toeCTRL) + '.rotate',str(toeCTRL) + '.rotate')
		maya.cmds.connectAttr(str(toeCTRL) + '.rx',str(toeJoint) + '.ry')
		maya.cmds.connectAttr(str(toeCTRL) + '.ry',str(toeJoint) + '.rx')
		maya.cmds.connectAttr(str(toeCTRL) + '.rz',str(toeJoint) + '.rz')
	
	

def setUpFKstretch(prefix,jointAimAxis,limbTypeName,jointArray,howManyNodes,mainCtrl,startCTRL,endCTRL):
	#select second and last joint of Ik Chain, then the ctrl
	howManyJoints = len(jointArray)
	
	#defaultAttr = '.default' #must be boolean
	#stretchAttr = '.stretchFK'

	stretchNormaliseNode = prefix + 'stretchNormalise_setRange'
	#FKPlusNode = prefix + 'default_plusMinusAverage'
	FKNormaliseNode = prefix + 'scale_multiplyDivide'
	
	startJoint = jointArray[0]
	print('startJoint = ' + str(startJoint))
	endJoint = jointArray[len(jointArray)-1]
	print('endJoint = ' + str(endJoint))

	#START///////////////////////////////////CREATE SETRANGE, MULTIPLYDIVIDE NODES AND 
	#START///////////////////////////////////FOR ALL THE FK JOINTS. GET EACH FK JOINT TX VALUE 
	#START///////////////////////////////////
	
	#create set range node to normalise the stretch FK attribute*********************START**********create set range node to normalise the stretch FK attribute
	
	setRangeNode = maya.cmds.shadingNode('setRange',n=stretchNormaliseNode,au=True)
	connector = ''
	if(limbTypeName == 'arm_'):
		connector = endCTRL + '.stretchFK'
		checkAttrExist(endCTRL,'stretchFK','double',0,1000,1,True)
	else:
		connector = mainCtrl + '.stretchFK'
		checkAttrExist(mainCtrl,'stretchFK','double',0,1000,1,True)
	socket = setRangeNode + '.valueX'
	maya.cmds.connectAttr(connector, socket, force=True)

	maya.cmds.setAttr(setRangeNode + '.oldMaxX', 1000)
	maya.cmds.setAttr(setRangeNode + '.maxX', 100)
	#create set range node to normalise the stretch FK attribute*********************END**********create set range 
	
	#IKConditionNode = conditionNode
	#IKNormaliseNode = normaliseNode
	#IKAutoStretchNode = autoStretch
	#IKStretchNode = stretch;
	#stretchNormaliseNode = setRangeNode

	#END///////////////////////////////////CREATE SETRANGE, MULTIPLYDIVIDE NODES AND 
	#END///////////////////////////////////FOR ALL THE FK JOINTS. GET EACH FK JOINT TX VALUE 
	#END///////////////////////////////////

	#START/////////////////////////////////////////////////////////////MULTIPLIER NODES READY TO BE CONNECT RO IK JOINT TRANSLATEX
	multiplierNodes = []
	for i in range(0,howManyNodes,1):
		multiplierNode = maya.cmds.shadingNode('multiplyDivide',n=FKNormaliseNode + '1',au=True)
		#multiplierNodes[i] = multiplierNode
		multiplierNodes.append(multiplierNode)

	#END///////////////////////////////////////////////////////////////MULTIPLIER NODES READY TO BE CONNECT RO IK JOINT TRANSLATEX

	#START/////////////////////////////////////////////////////////////CONNECT THE CONDITION NODE TO MULTIPLIER NODES READY TO BE CONNECT TO IK JOINT TRANSLATEX
	connectorAttribute1 = '.valueX'
	socketAttribute1 = '.input' 
	connector1 = stretchNormaliseNode + connectorAttribute1

	connectorAttribute2 = '.output'

	whichJoint = 1 #start with the second joint
	brake = 0

	#CONNECT SETRANGE NODE TO MULYIPLIER NODES THEN TO INDIVIDUAL JOINTS
	for i in range(0,howManyNodes,1):
		multiply = i + 1 #use to select the right joint in $sel[] and "spine_multiplier_multiplyDivide" node
	
		whichAxis = [' ', 'X', 'Y', 'Z']
		for j in range(1,4,1):
			if(brake == 0):
				socket1 = multiplierNodes[i] + (socketAttribute1 + '1' + whichAxis[j])
				maya.cmds.connectAttr(connector1, socket1, force=True)
		
				getAttr = maya.cmds.getAttr(jointArray[whichJoint] + '.t' + jointAimAxis)
				setAttr = maya.cmds.setAttr(multiplierNodes[i] + (socketAttribute1 + '2' + whichAxis[j]), getAttr)
		
				#connector2 = IKMultiplierNode + str(multiply) + (connectorAttribute2 + whichAxis[j])
				connector2 =  multiplierNodes[i] + (connectorAttribute2 + whichAxis[j])
				print ('connector2 = ' + str(connector2))
				socket2 = (jointArray[whichJoint] + '.t' + jointAimAxis)
				print ('socket2 = ' + str(socket2))
				maya.cmds.connectAttr(connector2, socket2, force=True)

				whichJoint = whichJoint + 1
	
				print ('whichJoint = ' + str(whichJoint))
				print ('howManyJoints = ' + str(howManyJoints))

				#LOOP BREAK TO CATER FOR ODD NUMBER OF JOINTS
				if(whichJoint == howManyJoints):
					brake = 1
	
		print ('i = ' + str(i) )

	#END//////////////////////////////////////////////////////////////CONNECT THE CONDITION NODE TO MULTIPLIER NODES READY TO BE CONNECT TO IK JOINT TRANSLATEX
	#================================================================================================================================
	#END++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

def masterCreateFK(sidePrefix,jointType,limbType,limbTypeName,upAxis,jointAimAxis,ctrlAimAxis,startJoint,midJoint,endJoint,toeJoint,mainCTRL,startCTRL,midCTRL,endCTRL,pvCTRL):
	prefix = sidePrefix + jointType

	groupsCTRL = ['char_GRP','DO_NOT_ALTER_GRP','skeleton_scale_GRP','CTRL_skeleton_GRP']
	groupsDIM = ['char_GRP','DO_NOT_ALTER_GRP','dimension_GRP']
	skeletonCtrlGrp = groupsCTRL[3]

	toeJoint = sidePrefix + 'toe'

	maya.cmds.select(startJoint)
	maya.cmds.select(hierarchy = True)
	selHi = maya.cmds.ls(selection = True)
	if(limbTypeName == 'leg_'):
		if maya.cmds.objExists(toeJoint):
			selectedJoints = filterSelection2(selHi,toeJoint,1)
		else:
			selectedJoints = filterSelection2(selHi,endJoint,1)
	else:
		selectedJoints = filterSelection2(selHi,endJoint,1)
	print('selectedJoints = ' + str(selectedJoints))
	
	maya.cmds.select(clear=True)

	setUpGrp(groupsCTRL)
	setupPolVector(pvCTRL,midJoint,0,upAxis)

	#ikJoints are only the joints that make up the IKPhandle chain
	fkJoints = createIKjoints(selectedJoints,sidePrefix,jointType,groupsCTRL)
	print('fkJoints = ' + str(fkJoints))
	ej = prefix + findNamePrefix(endJoint,sidePrefix)
	print('ej = ' + str(ej))

	prefix = sidePrefix + jointType# + limbTypeName
	#print('ikendJoint = ' + str(ikendJoint))
	fkJointsFiltered = filterSelection2(fkJoints,ej,1)
	print('fkJointsFiltered = ' + str(fkJointsFiltered))
	print('len(fkJointsFiltered) = ' + str(len(fkJointsFiltered)))
	howManyNodes = int(math.ceil(len(fkJointsFiltered) / 3)) #This divided by three because of X,Y,Z
	print('howManyNodes = ' + str(howManyNodes))
	setUpFKstretch(prefix,jointAimAxis,limbTypeName,fkJointsFiltered,howManyNodes,mainCTRL,startCTRL,endCTRL)
	if(limbTypeName == 'leg_'):
		#if(limbType == ''):
		connectFKControls(limbTypeName,ctrlAimAxis,startCTRL,midCTRL,mainCTRL,endCTRL,prefix +'hip',prefix +'knee',prefix +'ankle',prefix +'foot')
	else:
		#if(limbType == ''):
		connectFKControls(limbTypeName,ctrlAimAxis,startCTRL,midCTRL,mainCTRL,endCTRL,prefix +'shoulder',prefix +'elbow',prefix +'wrist','')

	return fkJoints

#### END    - SETUP FK SYSTEM   ##########################################################################################################################################################################	
#### START - SplineIK ####################################################################################################################################################################################
def insertHowManySplineIKJoints(howManyTweenJoints,howManySplineIKControlJoints,tweenSplineJoints):
	tsj = tweenSplineJoints * (howManySplineIKControlJoints + 1)
	#print('cj = ' + str(cj))
	#tsj = (cj+1) * tweenSplineJoints
	print('tsj = ' + str(tsj))
	#print('tweenSplineJoints = ' + str(tweenSplineJoints))
	multiplier = tweenSplineJoints + 1
	if(howManySplineIKControlJoints == 0):
		multiplier = 0
	if(tweenSplineJoints == 0):
		#tweenSplineJoints = 1
		tsj = tweenSplineJoints + howManySplineIKControlJoints
		multiplier = 1
	print('multiplier = ' + str(multiplier))
	return (tsj,multiplier)

def setUpSplineIKstretch(jointArray,prefix,crve,aimAxis):
	splineNormaliseNode = prefix + 'spline_normalize_multiplyDivide'
	splineMultiplyNode = prefix + 'spline_multiplier_multiplyDivide'
	curveInfo = prefix + 'spline_curveInfo1'

	howManyJoints = len(jointArray)

	howManyNodes = int(math.ceil(len(jointArray) / 3))
	#START////////////////////////////////////////////////////////////////////////////////////CREATE CURVE INFO NODE FOR CHAR SPINE 
	#CREATE CURVE INFO AND MULTIPLYDIVIDE NODES
	curveInfoNode = maya.cmds.arclen(crve, ch=True)
	multiplierNode = maya.cmds.shadingNode('multiplyDivide',n=splineNormaliseNode + '1',au=True)

	splineNormalise = multiplierNode #ENSURE THAT THERE CONTINUITY THROUGH OUT THE SCRIPT

	#CONNECT ARCLENGTH TO INPUT1X 
	socket = multiplierNode + '.input1X'
	connector = curveInfoNode + '.arcLength'
	maya.cmds.connectAttr(connector, socket, force=True)

	#SET INPUT2X TO ARCLENGTH VALUE AND SET MULTIPLEDIVED NODES OPERATION TO DIVIDE
	socketAttribute = '.input2X'

	maya.cmds.setAttr(multiplierNode + '.operation',2)
	arcLength = maya.cmds.getAttr(connector)

	maya.cmds.setAttr(multiplierNode + '.input2X', arcLength)

	maya.cmds.rename(curveInfoNode, curveInfo)
	#print('splineMultiplyNode = ' + str(splineMultiplyNode))
	#END/////////////////////////////////////////////////////////////////////////////////////CREATE CURVE INFO NODE FOR CHAR SPINE 

	#START///////////////////////////////////////////////////////////////////////////////////CREATE MULTIPLYDIVIDE NODES TO BE CONNECTED TO THE INDIVIDUAL JOINTS TRANSLATEX 
    	splineMultiply = []
    	#CREATE MULTIPLYDIVIDE NODES 
    	for i in range(0,howManyNodes,1):
		temp = maya.cmds.shadingNode('multiplyDivide', n=splineMultiplyNode + str(1), au=True)
		splineMultiply.append(temp)
		
	print ('splineMultiply = ' + str(splineMultiply))

	connectorAttribute1 = '.outputX' #change this variable
	socketAttribute1 = '.input' #change this variable
	connector1 = splineNormalise + connectorAttribute1
	connectorAttribute2 = '.output'
	
	whichJoint = 1

	whichAxis = [' ', 'X', 'Y', 'Z']
	brake = 0

	print ('jointArray 1 = ' + str(jointArray))

	#CONNECT THE NORMALISE NODE TO THE MULTIPLYDIVIDE NODES, COPY SPINE JOINT TRANSLATEX TO MULTIPLYDIVIDE NODES INPUT 1XYZ ATTRIBUTES AND 
	#CONNECT MULTIPLYDIVIDE NODES OUTPUT XYZ TO SPINE JOINT TRANSLATEX
	for i in range(0, howManyNodes, 1):
		
		#multiply = i + 1
	
		for j in range(1, 4, 1):
			if(brake == 0):
				
				#socket1 = splineMultiply + str(multiply) + (socketAttribute1 + '2' + whichAxis[j])
				socket1 = splineMultiply[i] + (socketAttribute1 + '2' + whichAxis[j])
				maya.cmds.connectAttr(connector1, socket1, force=True)
		
				getAttribute = maya.cmds.getAttr(jointArray[whichJoint] + '.t' + aimAxis)
				#setAttr = maya.cmds.setAttr(splineMultiplyNode + str(multiply) + (socketAttribute1 + '1' + whichAxis[j]), getAttr)
				setAttr = maya.cmds.setAttr( splineMultiply[i] + (socketAttribute1 + '1' + whichAxis[j]), getAttribute)
		
				connector2 = splineMultiply[i] + (connectorAttribute2 + whichAxis[j])
				print ('connector2 = ' + str(connector2))
				socket2 = (jointArray[whichJoint] + '.t' + aimAxis)
				print ('socket2 = ' + str(socket2))
				maya.cmds.connectAttr(connector2, socket2, force=True)

				whichJoint = whichJoint + 1
	
				print ('whichJoint = ' + str(whichJoint))
				print ('howManyJoints = ' + str(howManyJoints))

				#LOOP BREAK TO CATER FOR ODD NUMBER OF JOINTS
				if(whichJoint == howManyJoints):
					brake = 1

	#END/////////////////////////////////////////////////////////////////////////////////////CREATE MULTIPLYDIVIDE NODES TO BE CONNECTED TO THE INDIVIDUAL JOINTS TRANSLATEX 

		 
def setUpSplineIKControls(clustered, ikCtrl, fkCtrl, splineIkCtrl, offset, name):
	ik = None
	fk = None
	if(clustered == True):
		#point constrain the cluster to the nearest control joint
		if(ikCtrl != None):
			ik = setConstraint('parent', ikCtrl, splineIkCtrl, True, name)
			if(fkCtrl != None):
				fk = setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
			else:
				print('WARNING :: fkCtrl has no controls.')
		else:
			print('WARNING :: ikCtrl has no controls.')
			if(fkCtrl != None):
				fk = setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
			else:
				print('WARNING :: fkCtrl has no controls.')
	else:
		if(ikCtrl != None):
			ik = setConstraint('parent', ikCtrl, splineIkCtrl, offset, name)
			if(fkCtrl != None):
				fk = setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
			else:
				print('WARNING :: fkCtrl has no controls.')
		else:
			print('WARNING :: ikCtrl has no controls.')
			if(fkCtrl != None):
				fk = setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
			else:
				print('WARNING :: fkCtrl has no controls.')
			
	return(ik,fk)

def setUpSplineToeJoints(ikCtrl, fkCtrl, splineIkJoint, offset, name):
	ik = None
	fk = None
	if(ikCtrl != None):
		ik = setConstraint('parent', ikCtrl, splineIkJoint, offset, name)
		if(fkCtrl != None):
			fk = setConstraint('parent', fkCtrl, splineIkJoint, offset, name)
		else:
			print('WARNING :: fkCtrl has no controls.')
	else:
		print('WARNING :: ikCtrl has no controls.')
		if(fkCtrl != None):
			fk = setConstraint('parent', fkCtrl, splineIkJoint, offset, name)
		else:
			print('WARNING :: fkCtrl has no controls.')
	return(ik,fk)

def setUpIKFKparent(ikCtrl, fkCtrl, splineIkCtrl, offset, name):
	ik = None
	constraint = None
	#fk = None
	if(ikCtrl != None):
		constraint = setConstraint('parent', ikCtrl, splineIkCtrl, True, name)
		if(fkCtrl != None):
			setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
		else:
			print('WARNING :: fkCtrl has no controls.')
	else:
		print('WARNING :: ikCtrl has no controls.')
		if(fkCtrl != None):
			constraint = setConstraint('parent', fkCtrl, splineIkCtrl, offset, name)
		else:
			print('WARNING :: fkCtrl has no controls.')
	return constraint

def createSplineIKControls(jointsArray, masterCtrl):
	grpArray = []
	ctrlArray = []
	#create the controls
	for i in range(0, len(jointsArray), 1):
		#select only the control joints
		index = i # * divide
		#print ('index = ' + index + ';   ')
	
		copy = maya.cmds.duplicate(masterCtrl, n=(jointsArray[index] + '_CTRL'))
		group1 = maya.cmds.group(copy[0], n=(jointsArray[index] + '_AV'))
		group2 = maya.cmds.group(group1, n=(jointsArray[index] + '_NULL'))
		group3 = maya.cmds.group(group2, n=(jointsArray[index] + '_GRP'))
		grpArray.append(group3)
		ctrlArray.append(copy[0])
			
		parentConstraint = maya.cmds.pointConstraint( jointsArray[index], group3)
		maya.cmds.delete(parentConstraint[0])
		
		maya.cmds.select(copy[0])
		maya.cmds.makeIdentity( apply=True, translate=True, rotate=True, scale=True, normal=False)

	return(ctrlArray,grpArray)


def masterSetUpSplineIK(selection,sidePrefix,jointType,limbType,limbTypeName,upAxis,jointOrientAxis,jointAimAxis,createSplineIK,howManyTweenJoints,howManySplineCtrlJoints,howManySplineSmthJoints,ikJointArray,fkJointArray,masterSplineIKCTRL,mainCTRL,endCTRL,ikfkSwitch):
	print('masterSetUpSplineIK :: selection = ' + str(selection))
	prefix = sidePrefix + jointType
	clustered = False

	ikJoint = None
	fkJoint = None
	ikj = False
	fkj = False

	groupSkeleton = ['char_GRP','DO_NOT_ALTER_GRP','skeleton_scale_GRP','CTRL_skeleton_GRP']
	#groupDim = ['char_GRP','DO_NOT_ALTER_GRP','dimension_GRP']
	groupCurves = ['char_GRP','DO_NOT_ALTER_GRP','curves_GRP']
	groupHandles = ['char_GRP','DO_NOT_ALTER_GRP','handles_GRP',sidePrefix + jointType + limbTypeName + 'cluster_GRP']
	groupControls = ['char_GRP','DO_NOT_ALTER_GRP','controls_GRP',sidePrefix + jointType + limbTypeName + 'GRP']
	skeletonCtrlGrp = groupSkeleton[3]
	controlGrp = groupControls[3]
	startJoint = selection[0]
	midJoint = selection[1]
	endJoint = selection[2]
	toeJoint = None

	maya.cmds.select(startJoint)
	maya.cmds.select(hierarchy = True)
	selHi = maya.cmds.ls(selection = True)
	splineIkJointstoMainCTRL = filterSelection2(selHi,endJoint,1)
	allKeySplineIKJoints = splineIkJointstoMainCTRL
	print('masterSetUpSplineIK :: allKeySplineIKJoints = ' + str(allKeySplineIKJoints))
	splineIkJointsToToe = []
	ikjointsToToe = []
	fkjointsToToe = []

	#if(selection[3] != ''):
	if maya.cmds.objExists(selection[3]):
		if(limbTypeName == 'leg_'):
			toeJoint = selection[3]
			print('masterSetUpSplineIK :: toeJoint = ' + str(toeJoint))
			allKeySplineIKJoints = filterSelection2(selHi,toeJoint,1)
			splineIkJointsToToe = allKeySplineIKJoints[len(splineIkJointstoMainCTRL):len(allKeySplineIKJoints)]
			ikjointsToToe = ikJointArray[len(splineIkJointstoMainCTRL):len(ikJointArray)]
			fkjointsToToe = fkJointArray[len(splineIkJointstoMainCTRL):len(fkJointArray)]

	ikJointsToMainCTRL = ikJointArray[0:len(splineIkJointstoMainCTRL)]
	fkJointsToMainCTRL = fkJointArray[0:len(splineIkJointstoMainCTRL)]
	
	maya.cmds.select(clear=True)
	setUpGrp(groupSkeleton)
	#splineIKCTRLjoints = splineIkJointstoMainCTRL
	#print('masterSetUpSplineIK :: splineIKCTRLjoints = ' + str(splineIKCTRLjoints))

	#ENSURE THAT KEY ATTRIBUTES EXISTS ON THE IKFK SWITCH CONTROL
	checkAttrExist(ikfkSwitch,'IkFk','double',0,10,0,True)
	checkAttrExist(ikfkSwitch,'spline','long',0,1,1,True)
	checkAttrExist(ikfkSwitch,'scaleSpline','double',0,100,1,False)
	
	#ej = endJoint
	#print('ej = ' + str(ej))
	#splineIKjointsFiltered = splineIkJointstoMainCTRL
	#print('masterSetUpSplineIK :: splineIKjointsFiltered = ' + str(splineIKjointsFiltered))
	
	#CALCULATE THE NUMBER OF SPLINE JOINTS TO INSERT
	insertSplineIkJoints = insertHowManySplineIKJoints(howManyTweenJoints,howManySplineCtrlJoints,howManySplineSmthJoints)
	insertedCtrlJoints = insertExtraJoints06(splineIkJointstoMainCTRL,howManySplineCtrlJoints,sidePrefix,'','',jointAimAxis,jointOrientAxis)
	splineIKCtrlJoints = insertedCtrlJoints[1]
	#splineIKjoints will eventally be appended with the additionally added smoothing joints
	splineIKjoints = insertedCtrlJoints[1]
	allKeySplineIKJoints = combineArrays(splineIKCtrlJoints,splineIkJointsToToe)
	stopIndex = len(splineIKCtrlJoints)
	splineConstraints = []
	splineIKcontrols = []
	constraintType = None
	setUpGrp(groupControls)

	print('masterSetUpSplineIK :: len(selection) = ' + str(len(selection)))
	print('masterSetUpSplineIK :: howManySplineSmthJoints = ' + str(howManySplineSmthJoints))
	print('masterSetUpSplineIK :: howManySplineCtrlJoints = ' + str(howManySplineCtrlJoints))
	print('masterSetUpSplineIK :: howManyTweenJoints = ' + str(howManyTweenJoints))
	print('masterSetUpSplineIK :: stopIndex = ' + str(stopIndex))
	print('masterSetUpSplineIK :: insertSplineIkJoints = ' + str(insertSplineIkJoints))
	print('masterSetUpSplineIK :: insertedCtrlJoints = ' + str(insertedCtrlJoints))
	print('masterSetUpSplineIK :: splineIKjoints = ' + str(splineIKjoints))
	print('masterSetUpSplineIK :: splineIKCtrlJoints = ' + str(splineIKCtrlJoints))
	print('masterSetUpSplineIK :: allKeySplineIKJoints = ' + str(allKeySplineIKJoints))
	print('masterSetUpSplineIK :: ikJointArray = ' + str(ikJointArray))
	print('masterSetUpSplineIK :: fkJointArray = ' + str(fkJointArray))
	print('masterSetUpSplineIK :: allKeySplineIKJoints = ' + str(allKeySplineIKJoints))
	print('masterSetUpSplineIK :: splineIkJointsToToe = ' + str(splineIkJointsToToe))
	print('masterSetUpSplineIK :: ikjointsToToe = ' + str(ikjointsToToe))
	print('masterSetUpSplineIK :: fkjointsToToe = ' + str(fkjointsToToe))
	print('masterSetUpSplineIK :: splineIkJointstoMainCTRL = ' + str(splineIkJointstoMainCTRL))
	print('masterSetUpSplineIK :: ikJointsToMainCTRL = ' + str(ikJointsToMainCTRL))
	print('masterSetUpSplineIK :: fkJointsToMainCTRL = ' + str(fkJointsToMainCTRL))

	if(len(ikJointArray) == len(allKeySplineIKJoints)):
		ikj = True
		print('masterSetUpSplineIK :: ikj = ' + str(ikj))
	if(len(fkJointArray) == len(allKeySplineIKJoints)):
		fkj = True
		print('masterSetUpSplineIK :: fkj = ' + str(fkj))

	if(createSplineIK == True):
		print('masterSetUpSplineIK :: splineIKCtrlJoints = ' + str(splineIKCtrlJoints))
		insertedSmthjoints = insertExtraJoints06(splineIKCtrlJoints,howManySplineSmthJoints,sidePrefix,'','_s',jointAimAxis,jointOrientAxis)
		print('masterSetUpSplineIK :: insertedSmthjoints = ' + str(insertedSmthjoints))
		splineIKsmthJoints = insertedSmthjoints[0]
		print('masterSetUpSplineIK :: splineIKsmthJoints = ' + str(splineIKsmthJoints))
		splineIKjoints = insertedSmthjoints[1]
		print('masterSetUpSplineIK :: splineIKjoints = ' + str(splineIKjoints))
		setUpGrp(groupHandles)
		setUpGrp(groupCurves)
		
		curve = createCurve(splineIKCtrlJoints, prefix + limbTypeName + 'curve',groupCurves[len(groupCurves)-1])
		print ('masterSetUpSplineIK :: curve = ' + str(curve))
		clusters = clusterCurve(curve[0],prefix + limbTypeName + 'CLUSTER_',groupHandles[len(groupHandles)-1])
		clustered = True
		
		splineIKstretchjoints = setUpSplineIKstretch(splineIKjoints[0:(len(splineIKjoints)-1)],prefix,curve[0],jointAimAxis)
		print('masterSetUpSplineIK :: splineIKjoints = ' + str(splineIKjoints))
		splineIK = createIKhandles(prefix,limbTypeName,'ikSplineSolver',splineIKjoints[0],splineIKjoints[len(splineIKjoints)-1],None,curve[0],groupHandles[2])

		splineIKcontrols = createSplineIKControls(splineIKCtrlJoints, masterSplineIKCTRL)
		maya.cmds.delete(masterSplineIKCTRL)
		print('masterSetUpSplineIK :: splineIKcontrols = ' + str(splineIKcontrols))
		
		for i in range(0,len(allKeySplineIKJoints),1):
			if(i < stopIndex):
				print('splineIKcontrols[1][i] = ' + str(splineIKcontrols[1][i]))
				aimControlsToJoints(splineIKCtrlJoints[i],splineIKcontrols[1][i],jointAimAxis)
				maya.cmds.parent(splineIKcontrols[1][i],controlGrp)
				setConstraint('point', splineIKcontrols[0][i], clusters[i], True, None)
			
				if(ikj == True):
					ikJoint = ikJointArray[i]
                
				if(fkj == True):
					fkJoint = fkJointArray[i]
			
				temp = setUpIKFKparent(ikJoint, fkJoint, splineIKcontrols[1][i], False, None)
				splineConstraints.append(temp)
				constraintType = temp[1]
			else:
				if(ikj == True):
					ikJoint = ikJointArray[i]
                
				if(fkj == True):
					fkJoint = fkJointArray[i]
				temp = setUpIKFKparent(ikJoint, fkJoint, allKeySplineIKJoints[i], False, None)
				splineConstraints.append(temp)

		splineRollAxis = 'X'
		splineRollAxisCtrl = endCTRL
		if(limbTypeName == 'leg_'):
			splineRollAxis = 'Y'
			splineRollAxisCtrl = mainCTRL

		if maya.cmds.objExists(splineRollAxisCtrl):
			source = splineRollAxisCtrl + '.rotate' + splineRollAxis
			destination = splineIK[0] + '.roll' # or '.twist'
			maya.cmds.connectAttr(source, destination, force=True)

	else:
		splineIKcontrols = createSplineIKControls(splineIKCtrlJoints, masterSplineIKCTRL)
		maya.cmds.delete(masterSplineIKCTRL)
		print('masterSetUpSplineIK :: splineIKcontrols = ' + str(splineIKcontrols))
		
		ikRollGroup = []
		fkRollGroup = []
		ikJointArrayWithRoll = []
		fkJointArrayWithRoll = []
		if(ikj == True):
			if(limbTypeName == 'arm_'):
				if maya.cmds.objExists(endCTRL):
					ikRollGroup = createRoll(sidePrefix+jointType+limbTypeName,ikJointsToMainCTRL,120,[[0.0,0.0,3],[1.0,1.0,3],[0.5,0.12,3],[0.8,0.380,3]],'X','X',endCTRL,1)
			if(limbTypeName == 'leg_'):
				if maya.cmds.objExists(mainCTRL):
					ikRollGroup = createRoll(sidePrefix+jointType+limbTypeName,ikJointsToMainCTRL,30,[[1.0,0.0,3],[0.0,1.0,3],[0.5,0.6,3]],'X','Y',mainCTRL,1)
			ikJointArrayWithRoll = combineArrays(ikRollGroup[1],ikjointsToToe)
			if(fkj == True):
				if(limbTypeName == 'arm_'):
					if maya.cmds.objExists(endCTRL):
						
						fkRollGroup = connectRoll(ikRollGroup[0],fkJointsToMainCTRL,'X')
				if(limbTypeName == 'leg_'):
					if maya.cmds.objExists(mainCTRL):
						fkRollGroup = connectRoll(ikRollGroup[0],fkJointsToMainCTRL,'X')
				
				fkJointArrayWithRoll = combineArrays(fkRollGroup[1],fkjointsToToe)
			else:
				fkJointArrayWithRoll = fkJointArray
		elif(fkj == True):
			if(fkj == True):
				if(limbTypeName == 'arm_'):
					if maya.cmds.objExists(endCTRL):
						fkRollGroup = createRoll(sidePrefix+jointType+limbTypeName,fkJointsToMainCTRL,120,[[0.0,0.0,3],[1.0,1.0,3],[0.5,0.12,3],[0.8,0.380,3]],'X','X',endCTRL,1)
				if(limbTypeName == 'leg_'):
					if maya.cmds.objExists(mainCTRL):
						fkRollGroup = createRoll(sidePrefix+jointType+limbTypeName,fkJointsToMainCTRL,30,[[1.0,0.0,3],[0.0,1.0,3],[0.5,0.6,3]],'X','Y',mainCTRL,1)
				ikJointArrayWithRoll = ikJointArray
				fkJointArrayWithRoll = combineArrays(fkRollGroup[1],fkjointsToToe)
		else:
			ikJointArrayWithRoll = ikJointArray
			fkJointArrayWithRoll = fkJointArray
			
		print('masterSetUpSplineIK :: ikJointArrayWithRoll = ' + str(ikJointArrayWithRoll))
		print('masterSetUpSplineIK :: fkJointArrayWithRoll = ' + str(fkJointArrayWithRoll))
		print('masterSetUpSplineIK :: allKeySplineIKJoints = ' + str(allKeySplineIKJoints))
		print('masterSetUpSplineIK :: splineIKcontrols[0] = ' + str(splineIKcontrols[0]))
		for i in range(0,len(splineIKCtrlJoints),1):
			if(i < stopIndex):
				print('masterSetUpSplineIK :: splineIKcontrols[1][i] = ' + str(splineIKcontrols[1][i]))
				aimControlsToJoints(splineIKCtrlJoints[i],splineIKcontrols[1][i],jointAimAxis)
				maya.cmds.parent(splineIKcontrols[1][i],controlGrp)
				setConstraint('parent', splineIKcontrols[0][i], splineIKCtrlJoints[i], True, None)
				
				if(ikj == True):
					ikJoint = ikJointArrayWithRoll[i]
                
				if(fkj == True):
					fkJoint = fkJointArrayWithRoll[i]
			
				temp = setUpIKFKparent(ikJoint, fkJoint, splineIKcontrols[1][i], False, None)
				splineConstraints.append(temp)
				constraintType = temp[1]
			else:
				if(ikj == True):
					ikJoint = ikJointArrayWithRoll[i]
                
				if(fkj == True):
					fkJoint = fkJointArrayWithRoll[i]
				temp = setUpIKFKparent(ikJoint, fkJoint, allKeySplineIKJoints[i], True, None)
				splineConstraints.append(temp)
	
	print('masterSetUpSplineIK :: splineConstraints = ' + str(splineConstraints))
	#if(ikfkSwitch != ''):
	if maya.cmds.objExists(ikfkSwitch):
		print('masterSetUpSplineIK :: ikfkSwitch = ' + str(ikfkSwitch))
		setUpIKFKswitch(sidePrefix + limbTypeName,splineConstraints,ikfkSwitch,ikj,fkj)

	#ADD SCALE and VISIBILITY CONTROLS TO THE SPLINE IK CONTROLS
	for s in splineIKcontrols[0]:
		source = ikfkSwitch + '.scaleSpline'
		print ('masterSetUpSplineIK :: source = ' + str(source))
		destination = (s + '.scaleX')
		print ('masterSetUpSplineIK :: destination = ' + str(destination))
		maya.cmds.connectAttr(source, destination, force=True)
		destination = (s + '.scaleY')
		print ('masterSetUpSplineIK :: destination = ' + str(destination))
		maya.cmds.connectAttr(source, destination, force=True)
		destination = (s + '.scaleZ')
		print ('masterSetUpSplineIK :: destination = ' + str(destination))
		maya.cmds.connectAttr(source, destination, force=True)
		source = ikfkSwitch + '.spline'
		destination = (s + '.visibility')
		maya.cmds.connectAttr(source, destination, force=True)
	
	
#### END  - SplineIK ####################################################################################################################################################################################

def editTxtGrpButton(name,type):
	item = maya.cmds.ls(selection=True)
	if(len(item) == 1):
		if(type == 'textFieldButtonGrp'):
			maya.cmds.textFieldButtonGrp( name, e=True, text=str(item[0]))
	else:
		print('ERROR :: Select one item only, current items selected : ' + str(item))

def togglesystems(windowName):
	print('togglesystems :: togglesystems()')
	ikState = maya.cmds.checkBox(windowName + '_chckIK', q=True, value=True)
	print('togglesystems :: ikState = ' + str(ikState))
	fkState = maya.cmds.checkBox(windowName + '_chckFK', q=True, value=True)
	print('togglesystems :: fkState = ' + str(fkState))
	splineState = maya.cmds.checkBox(windowName + '_chckSPL', q=True, value=True)
	print('togglesystems :: splineState = ' + str(splineState))	
	useCurve = maya.cmds.checkBoxGrp(windowName + '_useSplineCurve', q=True, value1=True )
	print('togglesystems :: useCurve = ' + str(useCurve))
	numberSubJoints = maya.cmds.intFieldGrp( windowName + '_howwManyJointstoInsert', q=True, value1=True )
		
	if(numberSubJoints <= 0):
		maya.cmds.intFieldGrp( windowName + '_howwManyJointstoInsert', e=True, value1=0 )
		maya.cmds.textFieldGrp( windowName + '_subJointName', e=True, en=False )
	else:
		maya.cmds.textFieldGrp( windowName + '_subJointName', e=True, en=True )

	if(fkState == False):
		maya.cmds.columnLayout('FK',  e=True, en=False)
		if(splineState == False):
			maya.cmds.checkBox(windowName + '_chckIK', e=True, ed=False, value=True)
		else:
			maya.cmds.checkBox(windowName + '_chckIK', e=True, ed=True)
	else:
		maya.cmds.checkBox(windowName + '_chckIK', e=True, ed=True)
		maya.cmds.columnLayout('FK',  e=True, en=True)
	if(splineState == False):
		maya.cmds.columnLayout('SplineIK',  e=True, en=False)
		if(ikState == False):
			maya.cmds.checkBox(windowName + '_chckFK', e=True, ed=False, value=True)
		else:
			maya.cmds.checkBox(windowName + '_chckFK', e=True, ed=True)
	else:
		maya.cmds.checkBox(windowName + '_chckFK', e=True, ed=True)
		maya.cmds.columnLayout('SplineIK',  e=True, en=True)
	if(ikState == False):
		maya.cmds.columnLayout('IK',  e=True, en=False)
		if(fkState == False):
			maya.cmds.checkBox(windowName + '_chckSPL', e=True, ed=False, value=True)
		else:
			maya.cmds.checkBox(windowName + '_chckSPL', e=True, ed=True)
	else:
		maya.cmds.checkBox(windowName + '_chckSPL', e=True, ed=True)
		maya.cmds.columnLayout('IK',  e=True, en=True)

	if(useCurve == False):
		maya.cmds.intFieldGrp(windowName + '_howwManySplineSmoothJoints', e=True, value1=0, en=False )
	else:
		maya.cmds.intFieldGrp(windowName + '_howwManySplineSmoothJoints', e=True, value1=1, en=True )
	

		

def whichAxis(value):
	axis = ['x','X']
	if(value == 2):
		axis = ['y','Y']
	elif(value == 3):
		axis = ['z','Z']
	return axis

def whichType(value):
	#'bipedLeg', 'Quadraped', 'misc'
	type = 'BipedLeg'
	if(value == 2):
		type = 'Quadraped'
	elif(value == 3):
		type = 'misc'
	return type

def preset(type,windowName):
	if(type == 'leg'):
		maya.cmds.textFieldGrp( windowName + '_limbTypeName', e=True, text='leg_' )
		maya.cmds.textFieldGrp( windowName + '_subJointName', e=True, text='thigh shin' )
		sp = maya.cmds.textFieldGrp( windowName + '_sidePrefix', q=True, text=True )
		ltn = maya.cmds.textFieldGrp( windowName + '_limbTypeName', q=True, text=True )
		ik = maya.cmds.textFieldGrp( windowName + '_IK', q=True, text=True ) 
		getIkFkswitch = sp + ltn + 'IKFK_CTRL'
		maya.cmds.textFieldButtonGrp( windowName + '_IKFK_switch', e=True, text=getIkFkswitch )
		getstartJoint = sp + 'hip'
		getMidJoint = sp + 'knee'
		getEndJoint = sp + 'ankle'
		getToeJoint = sp + 'toe'
		maya.cmds.textFieldButtonGrp( windowName + '_startJoint', e=True, text=getstartJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_midJoint', e=True, text=getMidJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_endJoint', e=True, text=getEndJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_toeJoint', e=True, text=getToeJoint )
	
		getIkMainCtrl = sp + ik + 'foot_CTRL'
		getIkStartCtrl = sp + ik + 'hip_LOC'
		getIkMidnCtrl = sp + ik + 'knee_CTRL'
		getIkEndCtrl = ''
		getIkpvCtrl = sp + ik + ltn + 'poleVector_CTRL'
		getIkheelJnt = sp + 'heel'
		maya.cmds.textFieldButtonGrp( windowName + '_IKmainCtrl', e=True, text=getIkMainCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKstartCTRL', e=True, text=getIkStartCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKmidCTRL', e=True, text=getIkMidnCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKendCtrl', e=True, text=getIkEndCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKpvCtrl', e=True, text=getIkpvCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKheel', e=True, text=getIkheelJnt )

		fk = maya.cmds.textFieldGrp( windowName + '_FK', q=True, text=True ) 
		getFkMainCtrl = sp + fk + 'foot_CTRL'
		getFkStartCtrl = sp + fk + 'hip_CTRL'
		getFkMidnCtrl = sp + fk + 'knee_CTRL'
		getFkEndCtrl = sp + fk + 'toe_CTRL'
		getFkpvCtrl = sp + fk + ltn + 'poleVector_tracking_LOC'
		maya.cmds.textFieldButtonGrp( windowName + '_FKmainCtrl', e=True, text=getFkMainCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKstartCTRL', e=True, text=getFkStartCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKmidCTRL', le=True, text=getFkMidnCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKendCtrl', e=True, text=getFkEndCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKpvCtrl', le=True, text=getFkpvCtrl )
	
	if(type == 'arm'):
		maya.cmds.textFieldGrp( windowName + '_limbTypeName', e=True, text='arm_' )
		maya.cmds.textFieldGrp( windowName + '_subJointName', e=True, text='bicep fore' )
		sp = maya.cmds.textFieldGrp( windowName + '_sidePrefix', q=True, text=True )
		ltn = maya.cmds.textFieldGrp( windowName + '_limbTypeName', q=True, text=True )
		ik = maya.cmds.textFieldGrp( windowName + '_IK', q=True, text=True ) 
		getIkFkswitch = sp + ltn + 'IKFK_CTRL'
		maya.cmds.textFieldButtonGrp( windowName + '_IKFK_switch', e=True, text=getIkFkswitch )
		getstartJoint = sp + 'shoulder'
		getMidJoint = sp + 'elbow'
		getEndJoint = sp + 'wrist'
		getToeJoint = ''
		maya.cmds.textFieldButtonGrp( windowName + '_startJoint', e=True, text=getstartJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_midJoint', e=True, text=getMidJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_endJoint', e=True, text=getEndJoint )
		maya.cmds.textFieldButtonGrp( windowName + '_toeJoint', e=True, text=getToeJoint )

		getIkMainCtrl = sp + ik + 'wrist_CTRL'
		getIkStartCtrl = sp + ik + 'shoulder_LOC'
		getIkMidnCtrl = sp + ik + 'pvCTRL'
		getIkEndCtrl = sp + 'hand_CTRL'
		getIkpvCtrl = sp + ik + ltn + 'pvCTRL'
		getIkheelJnt = ''
		maya.cmds.textFieldButtonGrp( windowName + '_IKmainCtrl', e=True, text=getIkMainCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKstartCTRL', e=True, text=getIkStartCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKmidCTRL', e=True, text=getIkMidnCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKendCtrl', e=True, text=getIkEndCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKpvCtrl', e=True, text=getIkpvCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_IKheel', e=True, text=getIkheelJnt )

		fk = maya.cmds.textFieldGrp( windowName + '_FK', q=True, text=True ) 
		getFkMainCtrl = sp + fk + 'wrist_LOC'
		getFkStartCtrl = sp + fk + 'shoulder_CTRL'
		getFkMidnCtrl = sp + fk + 'elbow_CTRL'
		getFkEndCtrl = sp + 'hand_CTRL'
		getFkpvCtrl = sp + fk + ltn + 'poleVector_tracking_LOC'
		maya.cmds.textFieldButtonGrp( windowName + '_FKmainCtrl', e=True, text=getFkMainCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKstartCTRL', e=True, text=getFkStartCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKmidCTRL', e=True, text=getFkMidnCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKendCtrl', e=True, text=getFkEndCtrl )
		maya.cmds.textFieldButtonGrp( windowName + '_FKpvCtrl', e=True, text=getFkpvCtrl )

#Main function that is executed when the 
#
def buildIKFKSystem(windowName):
	brk = False

	#0=Right, 1=Left, 2=Centre, 3=Misc
	IKcolour = [4,7,24,5]
	FKColour = [13,14,17,11]
	splineIKColour = [23,30,22,28]

	print('buildIKFKsystem')
	ikState = maya.cmds.checkBox(windowName + '_chckIK', q=True, value=True)
	print('buildIKFKSystem :: ikState = ' + str(ikState))
	fkState = maya.cmds.checkBox(windowName + '_chckFK', q=True, value=True)
	print('buildIKFKSystem :: fkState = ' + str(fkState))
	splineIKState = maya.cmds.checkBox(windowName + '_chckSPL', q=True, value=True)
	print('buildIKFKSystem :: splineIKState = ' + str(splineIKState))
	#jointTypePrefix = ['thigh_','shin_','temp1_','temp2']
	jtp = maya.cmds.textFieldGrp( windowName + '_subJointName', q=True, text=True )
	jointTypePrefix = jtp.split()
	print('buildIKFKSystem :: jointTypePrefix = ' + str(jointTypePrefix))
	ikfkSwitchCTRL = maya.cmds.textFieldGrp( windowName + '_IKFK_switch', q=True, text=True )
	
	sidePrefix = maya.cmds.textFieldGrp( windowName + '_sidePrefix', q=True, text=True )
	sj = maya.cmds.textFieldButtonGrp( windowName + '_startJoint', q=True, text=True )
	mj = maya.cmds.textFieldButtonGrp( windowName + '_midJoint', q=True, text=True )
	ej = maya.cmds.textFieldButtonGrp( windowName + '_endJoint', q=True, text=True )
	tj = maya.cmds.textFieldButtonGrp( windowName + '_toeJoint', q=True, text=True )
	sel = [sj,mj,ej,tj]
	howManyJointsInserted = maya.cmds.intFieldGrp( windowName + '_howwManyJointstoInsert', q=True, value1=True )
	CAA = maya.cmds.radioButtonGrp( windowName + '_ctrlAimAxis', q=True, sl=True )
	ctrlAimAxis = whichAxis(CAA)
	print('buildIKFKSystem :: howManyJointsInserted = ' + str(howManyJointsInserted))
	JUA = maya.cmds.radioButtonGrp( windowName + '_upAxis', q=True, sl=True )
	upAxis = whichAxis(JUA)
	print('buildIKFKSystem :: upAxis = ' + str(upAxis))
	JAA = maya.cmds.radioButtonGrp( windowName + '_jointAimAxis', q=True, sl=True )
	jointAimAxis =  whichAxis(JAA)
	print('buildIKFKSystem :: jointAimAxis = ' + str(jointAimAxis))
	JOA = maya.cmds.radioButtonGrp( windowName + '_jointOrientAxis', q=True, sl=True )
	jointOrientAxis = whichAxis(JOA)
	print('buildIKFKSystem :: jointOrientAxis[1] = ' + str(jointOrientAxis[1]))
	#selectedJoints = [sj,mj,ej]
	#print('buildIKFKSystem :: selectedJoints = ' + str(selectedJoints))
	rebuildJoints = [sj,mj,ej]
	print('buildIKFKSystem :: rebuildJoints = ' + str(rebuildJoints))
	if((len(rebuildJoints)-1) > len(jointTypePrefix)):
		n = (len(rebuildJoints)-1) - len(jointTypePrefix)
		print('ERROR :: buildIKFKSystem :: You need to add ' + str(n) + ' name or names to the Name of Subjoints text feild under the Global Tab')
		brk = True

	if(brk == False):
		#jointsInserted = insertExtraJoints00(selectedJoints,howManyJointsInserted,sidePrefix,jointAimAxis[0],jointOrientAxis[1])
		jointsInserted = insertExtraJoints00(rebuildJoints,jointTypePrefix,sidePrefix,jointAimAxis[0],howManyJointsInserted)
		print('buildIKFKSystem :: jointsInserted = ' + str(jointsInserted))
		allDeformerJoints = []
		if maya.cmds.objExists(tj):
			maya.cmds.select( sj, hi=True )
			temp = maya.cmds.ls(selection=True)
			allDeformerJoints = filterSelection2(temp,tj,1)
		else:
			allDeformerJoints = jointsInserted[1]
		print('buildIKFKSystem :: allDeformerJoints = ' + str(allDeformerJoints))

		limbTypeName = maya.cmds.textFieldGrp( windowName + '_limbTypeName', q = True, text=True )	
		lt = maya.cmds.radioButtonGrp( windowName + '_limbType',  q=True, sl=True )
		limbType =  whichType(lt)

		ikJoints = []
		fkJoints = []
		ikmainCtrl = ''
		ikstartCtrl = ''
		ikmidCtrl = ''
		ikendCtrl = ''
		fkmainCtrl = ''
		fkstartCtrl = ''
		fkmidCtrl = ''
		fkendCtrl = ''
		ik = ''
		fk = ''
		ikj = False
		fkj = False
	
		if(ikState != False):
			ikj = True
			ik = maya.cmds.textFieldGrp( windowName + '_IK', q=True, text=True )
			print('buildIKFKSystem :: ik = ' + str(ik))
			ikmainCtrl = maya.cmds.textFieldButtonGrp( windowName + '_IKmainCtrl', q=True, text=True )
			ikstartCtrl = maya.cmds.textFieldButtonGrp( windowName + '_IKstartCTRL', q=True, text=True )
			ikmidCtrl = maya.cmds.textFieldButtonGrp( windowName + '_IKmidCTRL', q=True, text=True )
			ikendCtrl = maya.cmds.textFieldButtonGrp( windowName + '_IKendCtrl', q=True, text=True )
			ikpvCtrl = maya.cmds.textFieldButtonGrp( windowName + '_IKpvCtrl', q=True, text=True )
			heelJoint = maya.cmds.textFieldButtonGrp( windowName + '_IKheel', q=True, text=True )
	
			ikJoints = masterCreateIK(sidePrefix,ik,limbType,limbTypeName,upAxis[0],jointAimAxis[0],howManyJointsInserted,sj,mj,ej,tj,ikmainCtrl,ikstartCtrl,ikendCtrl,ikpvCtrl,ikfkSwitchCTRL,heelJoint)
			print('buildIKFKSystem :: ikJoints = ' + str(ikJoints))
		
		if(fkState != False):
			fkj = True
			fk = maya.cmds.textFieldGrp( windowName + '_FK', q=True, text=True )
			print('buildIKFKSystem :: fk = ' + str(fk))
			fkmainCtrl = maya.cmds.textFieldButtonGrp( windowName + '_FKmainCtrl', q=True, text=True )
			fkstartCtrl = maya.cmds.textFieldButtonGrp( windowName + '_FKstartCTRL', q=True, text=True )
			fkmidCtrl = maya.cmds.textFieldButtonGrp( windowName + '_FKmidCTRL', q=True, text=True )
			fkendCtrl = maya.cmds.textFieldButtonGrp( windowName + '_FKendCtrl', q=True, text=True )
			fkpvCtrl = maya.cmds.textFieldButtonGrp( windowName + '_FKpvCtrl', q=True, text=True )
			fkJoints = masterCreateFK(sidePrefix,fk,limbType,limbTypeName,upAxis[0],jointAimAxis[0],ctrlAimAxis[0],sj,mj,ej,tj,fkmainCtrl,fkstartCtrl,fkmidCtrl,fkendCtrl,fkpvCtrl)

		if(splineIKState != False):
			masterSplineCTRL = ''

			spl = maya.cmds.textFieldGrp( windowName + '_SPL', q=True, text=True )
			print('buildIKFKSystem :: spl = ' + str(spl))
			useCurve = maya.cmds.checkBoxGrp( windowName + '_useSplineCurve', q=True, value1=True )
			print('buildIKFKSystem :: useCurve = ' + str(useCurve))
			masterSplineCTRL = maya.cmds.textFieldButtonGrp( windowName + '_splineIkmasterCtrl', q=True, text=True )
			print('buildIKFKSystem :: masterSplineCTRL = ' + str(masterSplineCTRL))
			#howManySplineControlJoints = maya.cmds.intFieldGrp( windowName + '_howwManySplineControlJoints', numberOfFields=1, q=True, value1=True )
			howManySplineControlJoints = 0
			print('buildIKFKSystem :: howManySplineControlJoints = ' + str(howManySplineControlJoints))
			howwManySplineSmoothJoints = maya.cmds.intFieldGrp( windowName + '_howwManySplineSmoothJoints', q=True, value1=True )
			print('buildIKFKSystem :: howwManySplineSmoothJoints = ' + str(howwManySplineSmoothJoints))

			if(masterSplineCTRL == ''):
				masterSplineCTRL = createArrowCtrl(sidePrefix + limbTypeName + 'SPL_Master_CTRL',splineIKColour[2],'X',0.2)
				#print('buildIKFKSystem :: masterSplineCTRL = ' + str(masterSplineCTRL))
			else:
				temp = maya.cmds.textFieldButtonGrp( windowName + '_splineIkmasterCtrl', q=True, text=True )
				masterSplineCTRL = maya.cmds.duplicate(temp, n=sidePrefix + limbTypeName + 'SPL_Master_CTRL')
				#print('buildIKFKSystem :: masterSplineCTRL = ' + str(masterSplineCTRL))

			print('buildIKFKSystem :: masterSplineCTRL = ' + str(masterSplineCTRL))
			masterSetUpSplineIK(sel,sidePrefix,spl,limbType,limbTypeName,upAxis[0],jointOrientAxis[1],jointAimAxis[0],useCurve,howManyJointsInserted,howManySplineControlJoints,howwManySplineSmoothJoints,ikJoints,fkJoints,masterSplineCTRL,ikmainCtrl,ikendCtrl,ikfkSwitchCTRL)
		else:
			jointConstraints = []
			ikJoint = None
			fkJoint = None 
			ikRollGroup = []
			fkRollGroup = []
			ikJointArrayWithRoll = []
			fkJointArrayWithRoll = []

			#GET IK AND FK ROLL JOINTS
			howManyRollJoints = len(filterSelection2(allDeformerJoints,ej,1))
			ikRollJoints = ikJoints[0:howManyRollJoints]
			fkRollJoints = fkJoints[0:howManyRollJoints]

			ikjointsToToe = ikJoints[len(ikRollJoints):len(ikJoints)]
			fkjointsToToe = fkJoints[len(fkRollJoints):len(fkJoints)]

			print('buildIKFKSystem :: ikjointsToToe = ' + str(ikjointsToToe))
			print('buildIKFKSystem :: fkjointsToToe = ' + str(fkjointsToToe))
			print('buildIKFKSystem :: ikjointsToToe = ' + str(ikjointsToToe))
			print('buildIKFKSystem :: fkjointsToToe = ' + str(fkjointsToToe))
			
			#CREATE IK FK ROLL
			if(ikState != False):
				if(limbTypeName == 'arm_'):
					if maya.cmds.objExists(ikendCtrl):
						ikRollGroup = createRoll(sidePrefix+ik+limbTypeName,ikRollJoints,120,[[0.0,0.0,3],[1.0,1.0,3],[0.5,0.12,3],[0.8,0.380,3]],'X','X',ikendCtrl,1)
				if(limbTypeName == 'leg_'):
					if maya.cmds.objExists(ikmainCtrl):
						ikRollGroup = createRoll(sidePrefix+ik+limbTypeName,ikRollJoints,30,[[1.0,0.0,3],[0.0,1.0,3],[0.5,0.6,3]],'X','Y',ikmainCtrl,1)
				ikJointArrayWithRoll = combineArrays(ikRollGroup[1],ikjointsToToe)
				if(fkState != False):
					if(limbTypeName == 'arm_'):
						if maya.cmds.objExists(fkendCtrl):
							fkRollGroup = connectRoll(ikRollGroup[0],fkRollJoints,'X')
					if(limbTypeName == 'leg_'):
						if maya.cmds.objExists(fkmainCtrl):
							fkRollGroup = connectRoll(ikRollGroup[0],fkRollJoints,'X')
				
					fkJointArrayWithRoll = combineArrays(fkRollGroup[1],fkjointsToToe)
				else:
					fkJointArrayWithRoll = fkJoints
			elif(fkState != False):
				if(limbTypeName == 'arm_'):
					if maya.cmds.objExists(fkendCtrl):
						fkRollGroup = createRoll(sidePrefix+fk+limbTypeName,fkRollJoints,120,[[0.0,0.0,3],[1.0,1.0,3],[0.5,0.12,3],[0.8,0.380,3]],'X','X',fkendCtrl,1)
				if(limbTypeName == 'leg_'):
					if maya.cmds.objExists(fkmainCtrl):
						fkRollGroup = createRoll(sidePrefix+fk+limbTypeName,fkRollJoints,30,[[1.0,0.0,3],[0.0,1.0,3],[0.5,0.6,3]],'X','Y',fkmainCtrl,1)
				ikJointArrayWithRoll = ikJoints
				fkJointArrayWithRoll = combineArrays(fkRollGroup[1],fkjointsToToe)
			else:
				ikJointArrayWithRoll = ikJoints
				fkJointArrayWithRoll = fkJoints

			print('buildIKFKSystem :: ikJointArrayWithRoll = ' + str(ikJointArrayWithRoll))
			print('buildIKFKSystem :: fkJointArrayWithRoll = ' + str(fkJointArrayWithRoll))
			print('buildIKFKSystem :: allDeformerJoints = ' + str(allDeformerJoints))

			for i in range(0,len(allDeformerJoints),1):
				if(len(ikJointArrayWithRoll) == len(allDeformerJoints)):
					ikJoint = ikJointArrayWithRoll[i]
                
				if(len(fkJointArrayWithRoll) == len(allDeformerJoints)):
					fkJoint = fkJointArrayWithRoll[i]

				print('buildIKFKSystem :: fkJoint = ' + str(fkJoint))				
				print('buildIKFKSystem :: allDeformerJoints[i] = ' + str(allDeformerJoints[i]))
				temp = setUpIKFKparent(ikJoint, fkJoint, allDeformerJoints[i], False, None)
				jointConstraints.append(temp)
				constraintType = temp[1]
				print('buildIKFKSystem :: temp = ' + str(temp))
				print('buildIKFKSystem :: temp[1] = ' + str(temp[1]))
				print('buildIKFKSystem :: jointConstraints = ' + str(jointConstraints))
			
			if maya.cmds.objExists(ikfkSwitchCTRL):
				setUpIKFKswitch(sidePrefix + limbTypeName,jointConstraints,ikfkSwitchCTRL,ikj,fkj)

				
					




def buildIkFkWindow(windowName):
	questionButtonHeight=23
	maya.cmds.window( windowName, title= 'Build IK FK SplineIK', s=True, iconName='Short Name', widthHeight=(500, 450))
	maya.cmds.frameLayout(  windowName + '_frameLayout1', label=' ', borderStyle="in", lv=False, bv=False, mw=10, mh=10)
	maya.cmds.columnLayout(windowName + '_column1', adjustableColumn=True)

	maya.cmds.text( label= '   ' )

	maya.cmds.rowLayout(windowName + '_row1',numberOfColumns=3, columnWidth3=(80, 80, 80), adjustableColumn3=3, columnAlign3=('left','left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0), (3, 'both', 0)])
	
	maya.cmds.checkBox(windowName + '_chckIK', label='IK', value=True, cc='togglesystems("' + windowName + '")')
	maya.cmds.checkBox(windowName + '_chckFK', label='FK', value=True, cc='togglesystems("' + windowName + '")')
	maya.cmds.checkBox(windowName + '_chckSPL', label='Spline IK', value=True, cc='togglesystems("' + windowName + '")')
	maya.cmds.setParent('..')

	maya.cmds.text( label= '   ' )

	maya.cmds.frameLayout(windowName + '_formBase', label='Tabs', lv=False, labelAlign='top', borderStyle='in')
	form = maya.cmds.formLayout(windowName + '_form1')
	tabs = maya.cmds.tabLayout(windowName + '_tabs1', innerMarginWidth=5, innerMarginHeight=5)
	maya.cmds.formLayout( form, edit=True, attachForm=[(tabs, 'top', 0), (tabs, 'left', 0), (tabs, 'bottom', 0), (tabs, 'right', 0)] )
	
	maya.cmds.columnLayout('Global')
	maya.cmds.scrollLayout('Global' , width=500, height=300, horizontalScrollBarThickness=16, verticalScrollBarThickness=16)

	maya.cmds.rowLayout(windowName + '_row2',numberOfColumns=2, columnWidth2=(450, 20), adjustableColumn2=2, columnAlign2=('left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0)])
	
	maya.cmds.columnLayout(windowName + '_global1a', rs=3)
	maya.cmds.textFieldGrp( windowName + '_sidePrefix', label='Side Prefix:', text='L_' )
	sp = maya.cmds.textFieldGrp( windowName + '_sidePrefix', q=True, text=True )
	maya.cmds.textFieldGrp( windowName + '_limbTypeName', label='Limb Type Name:', text='leg_' )
	ltn = maya.cmds.textFieldGrp( windowName + '_limbTypeName', q=True, text=True )
	getIkFkswitch = sp + ltn + 'IKFK_CTRL'
	maya.cmds.radioButtonGrp( windowName + '_limbType', label='Type Of Limb:', labelArray3=['BipedLeg', 'QuadrapedLeg', 'Other'], numberOfRadioButtons=3, en=True, sl=1 )
	maya.cmds.radioButtonGrp( windowName + '_ctrlAimAxis', label='Control Aim Axis:', labelArray3=['x', 'y', 'z'], numberOfRadioButtons=3, en=True, sl=1 )
	maya.cmds.radioButtonGrp( windowName + '_upAxis', label='Joint Up Axis:', labelArray3=['x', 'y', 'z'], numberOfRadioButtons=3, en=True, sl=3 )
	maya.cmds.radioButtonGrp( windowName + '_jointAimAxis', label='Joint Aim Axis:', labelArray3=['x', 'y', 'z'], numberOfRadioButtons=3, en=True, sl=1 )
	maya.cmds.radioButtonGrp( windowName + '_jointOrientAxis', label='Joint Orient Axis:', labelArray3=['x', 'y', 'z'], numberOfRadioButtons=3, en=True, sl=3 )
	maya.cmds.intFieldGrp( windowName + '_howwManyJointstoInsert', numberOfFields=1, label='Number of Subjoints to insert:', value1=2, cc='togglesystems("' + windowName + '")', en=True )
	maya.cmds.textFieldGrp( windowName + '_subJointName', label='Name of Subjoints:', text='thigh shin', en=True )
	maya.cmds.textFieldButtonGrp( windowName + '_IKFK_switch', label='Get IKFK Switch:', text=getIkFkswitch, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKFK_switch' + '","textFieldButtonGrp")' )
	getstartJoint = sp + 'hip'
	getMidJoint = sp + 'knee'
	getEndJoint = sp + 'ankle'
	getToeJoint = sp + 'toe'
	msg = windowName + '_startJoint'
	run = 'runScript("' + windowName + '_startJoint' + '")'
	maya.cmds.textFieldButtonGrp( windowName + '_startJoint', label='Get Start Joint:', text=getstartJoint, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_startJoint' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_midJoint', label='Get Mid Joint:', text=getMidJoint, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_midJoint' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_endJoint', label='Get End Joint:', text=getEndJoint, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_endJoint' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_toeJoint', label='Get Toe Joint:', text=getToeJoint, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_toeJoint' + '","textFieldButtonGrp")' )
	maya.cmds.setParent('..')

	maya.cmds.columnLayout(windowName + '_global1b', rs=3)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.setParent('..')
	
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')

	maya.cmds.columnLayout('IK')
	maya.cmds.scrollLayout( windowName + '_scrollIK', width=500, height=300, horizontalScrollBarThickness=16, verticalScrollBarThickness=16)

	maya.cmds.rowLayout(windowName + '_row2',numberOfColumns=2, columnWidth2=(450, 20), adjustableColumn2=2, columnAlign2=('left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0)])
	
	maya.cmds.columnLayout(windowName + '_ik1a', rs=4)
	maya.cmds.textFieldGrp( windowName + '_IK', label='Joint Type:', text='IK_', en=True) 
	ik = maya.cmds.textFieldGrp( windowName + '_IK', q=True, text=True ) 
	getIkMainCtrl = sp + ik + 'foot_CTRL'
	getIkStartCtrl = sp + ik + 'hip_LOC'
	getIkMidnCtrl = sp + ik + 'knee_CTRL'
	getIkEndCtrl = ''
	getIkpvCtrl = sp + ik + ltn + 'poleVector_CTRL'
	getIkheelJnt = sp + 'heel'

	maya.cmds.textFieldButtonGrp( windowName + '_IKmainCtrl', label='Get IK Main Control:', text=getIkMainCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKmainCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_IKstartCTRL', label='Get IK Start Control:', text=getIkStartCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKstartCTRL' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_IKmidCTRL', label='Get IK Mid Control:', text=getIkMidnCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKmidCTRL' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_IKendCtrl', label='Get IK End Control:', text=getIkEndCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKendCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_IKpvCtrl', label='Get IK Pole Vector Control:', text=getIkpvCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKpvCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_IKheel', label='Get IK Heel Joint:', text=getIkheelJnt, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_IKheel' + '","textFieldButtonGrp")' )
	maya.cmds.setParent('..')

	maya.cmds.columnLayout(windowName + '_ik1b', rs=5)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')

	maya.cmds.columnLayout('FK')
	maya.cmds.scrollLayout( windowName + '_scrollFK', width=500, height=300, horizontalScrollBarThickness=16, verticalScrollBarThickness=16)

	maya.cmds.rowLayout(windowName + '_row2',numberOfColumns=2, columnWidth2=(450, 20), adjustableColumn2=2, columnAlign2=('left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0)])
	
	maya.cmds.columnLayout(windowName + '_fk1a', rs=4)
	maya.cmds.textFieldGrp( windowName + '_FK', label='Joint Type:', text='FK_', en=True) 
	fk = maya.cmds.textFieldGrp( windowName + '_FK', q=True, text=True ) 
	getFkMainCtrl = sp + fk + 'foot_CTRL'
	getFkStartCtrl = sp + fk + 'hip_CTRL'
	getFkMidnCtrl = sp + fk + 'knee_CTRL'
	getFkEndCtrl = sp + fk + 'toe_CTRL'
	getFkpvCtrl = sp + fk + ltn + 'poleVector_tracking_LOC'
	maya.cmds.textFieldButtonGrp( windowName + '_FKmainCtrl', label='Get FK Main Control:', text=getFkMainCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_FKmainCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_FKstartCTRL', label='Get FK Start Control:', text=getFkStartCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_FKstartCTRL' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_FKmidCTRL', label='Get FK Mid Control:', text=getFkMidnCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_FKmidCTRL' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_FKendCtrl', label='Get FK End Control:', text=getFkEndCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_FKendCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.textFieldButtonGrp( windowName + '_FKpvCtrl', label='Get FK Pole Vector Control:', text=getFkpvCtrl, buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_FKpvCtrl' + '","textFieldButtonGrp")' )
	maya.cmds.setParent('..')

	maya.cmds.columnLayout(windowName + '_fk1b', rs=6)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.button(label='?', height = questionButtonHeight)
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')


	maya.cmds.columnLayout('SplineIK')
	maya.cmds.scrollLayout( windowName + '_scrollSPLINE', width=500, height=300, horizontalScrollBarThickness=16, verticalScrollBarThickness=16)

	maya.cmds.rowLayout(windowName + '_row2',numberOfColumns=2, columnWidth2=(450, 20), adjustableColumn2=2, columnAlign2=('left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0)])
	
	maya.cmds.columnLayout(windowName + '_column1a', rs=4)
	maya.cmds.textFieldGrp( windowName + '_SPL', label='Joint Type:', text='SPL_', en=True) 
	spl = maya.cmds.textFieldGrp( windowName + '_SPL', q=True, text=True )
	maya.cmds.checkBoxGrp( windowName + '_useSplineCurve', numberOfCheckBoxes=1, label='Use Curve to Create IK:', value1=True, cc='togglesystems("' + windowName + '")' )
	maya.cmds.textFieldButtonGrp( windowName + '_splineIkmasterCtrl', label='Get Master Control:', text='', buttonLabel='Select', en=True, bc='editTxtGrpButton("' + windowName + '_splineIkmasterCtrl' + '","textFieldButtonGrp")' )
	#maya.cmds.intFieldGrp( windowName + '_howwManySplineControlJoints', numberOfFields=1, label='Number of Control Joints:', value1=1, en=True )
	maya.cmds.intFieldGrp( windowName + '_howwManySplineSmoothJoints', numberOfFields=1, label='Number of tween Joints:', value1=1, en=True )
	maya.cmds.setParent('..')

	maya.cmds.columnLayout(windowName + '_column1b')
	maya.cmds.button(label='?')
	maya.cmds.button(label='?')
	maya.cmds.button(label='?')
	#maya.cmds.button(label='?')
	maya.cmds.button(label='?')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')

	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	maya.cmds.setParent('..')
	
	maya.cmds.text( windowName + '_space1', label='Presets' )
	maya.cmds.rowLayout(windowName + '_row2',numberOfColumns=2, columnWidth2=(235, 235), adjustableColumn2=2, columnAlign2=('left','left'), columnAttach=[(1, 'both', 0), (2, 'both', 0)])
	maya.cmds.button(windowName + '_prestLeg', label='Preset Leg', c='preset(' + '"leg", "' + windowName + '")' )
	maya.cmds.button(windowName + '_prestArm', label='Preset Arm', c='preset(' + '"arm", "' + windowName + '")' )
	maya.cmds.setParent('..')
	maya.cmds.text( windowName + '_space2', label='' )
	maya.cmds.button(windowName + '_CreateSystem', label='Create IK/FK/SplineIK Systems', c='buildIKFKSystem("' + windowName + '")' )

	maya.cmds.showWindow( windowName )

#TESTS:
#1. Different Axis
#2. Reduce the radial Axis options
#3. Optional Stretch
#4. Optional Harden spline IK curve
#5. Smart notice of existence of different systems and options
#6. Clean up Names of different arrays in spline IK MASTER Function
#7. Reduce CV of Spline IK Master Control
#8. Add Attribute and Connections for Remap node in IK stretch

rebuildCurveWindowName = 'buildIKFKsystem'
deleteWindow(rebuildCurveWindowName)
buildIkFkWindow(rebuildCurveWindowName)
